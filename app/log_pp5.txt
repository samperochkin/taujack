
R version 4.2.1 (2022-06-23) -- "Funny-Looking Kid"
Copyright (C) 2022 The R Foundation for Statistical Computing
Platform: x86_64-pc-linux-gnu (64-bit)

R is free software and comes with ABSOLUTELY NO WARRANTY.
You are welcome to redistribute it under certain conditions.
Type 'license()' or 'licence()' for distribution details.

  Natural language support but running in an English locale

R is a collaborative project with many contributors.
Type 'contributors()' for more information and
'citation()' on how to cite R or R packages in publications.

Type 'demo()' for some demos, 'help()' for on-line help, or
'help.start()' for an HTML browser interface to help.
Type 'q()' to quit R.

> # Preprocessing of the raw data
> # launched with 
> # R CMD BATCH --vanilla --no-restore app/preprocessing.R app/log_pp.txt
> 
> # packages ----------------------------------------------------------------
> library(tidyverse)
── Attaching packages ─────────────────────────────────────── tidyverse 1.3.2 ──
✔ ggplot2 3.3.6     ✔ purrr   0.3.4
✔ tibble  3.1.8     ✔ dplyr   1.1.0
✔ tidyr   1.2.1     ✔ stringr 1.4.1
✔ readr   2.1.2     ✔ forcats 0.5.2
── Conflicts ────────────────────────────────────────── tidyverse_conflicts() ──
✖ dplyr::filter() masks stats::filter()
✖ dplyr::lag()    masks stats::lag()
> library(lubridate)

Attaching package: ‘lubridate’

The following objects are masked from ‘package:base’:

    date, intersect, setdiff, union

> library(lunar)
> library(ggplot2)
> library(spatstat.geom) # weighted ecdf
Loading required package: spatstat.data
spatstat.geom 3.2-4
> 
> 
> 
> # load and preprocess data ------------------------------------------------
> stns_id <- readRDS("app/data/stns_id.rds")
> weathercan::stations() %>% filter(station_id %in% stns_id, interval == "day") %>%
+   print(nrow = nrow(.))
The stations data frame hasn't been updated in over 4 weeks. Consider running `stations_dl()` to check for updates and make sure you have the most recent stations list available
# A tibble: 8 × 16
  prov  station…¹ stati…² clima…³ WMO_id TC_id   lat    lon   elev tz    inter…⁴
  <chr> <chr>       <dbl> <chr>    <dbl> <chr> <dbl>  <dbl>  <dbl> <chr> <chr>  
1 BC    QUATSINO      271 1036570     NA <NA>   50.5 -128.  3.42e0 Etc/… day    
2 BC    BARKERVI…     568 1090660     NA <NA>   53.1 -122.  1.28e3 Etc/… day    
3 BC    AGASSIZ …     707 1100120     NA <NA>   49.2 -122.  1.5 e1 Etc/… day    
4 ON    OTTAWA C…    4333 6105976     NA WCG    45.4  -75.7 7.92e1 Etc/… day    
5 ON    WELLAND      4712 6139445     NA <NA>   43.0  -79.3 1.75e2 Etc/… day    
6 ON    BELLEVIL…    4859 6150689     NA <NA>   44.2  -77.4 7.62e1 Etc/… day    
7 ON    BLOOMFIE…    4862 6150815     NA <NA>   44.0  -77.2 9.14e1 Etc/… day    
8 ON    TORONTO      5051 6158350  71266 <NA>   43.7  -79.4 1.12e2 Etc/… day    
# … with 5 more variables: start <dbl>, end <dbl>, normals <lgl>,
#   normals_1981_2010 <lgl>, normals_1971_2000 <lgl>, and abbreviated variable
#   names ¹​station_name, ²​station_id, ³​climate_id, ⁴​interval
> 
> filepaths <- paste0("app/data/daily_data_", stns_id, ".rds")
> data <- lapply(filepaths, readRDS) |> dplyr::bind_rows()
> str(data)
tibble [421,408 × 37] (S3: tbl_df/tbl/data.frame)
 $ station_name      : chr [1:421408] "QUATSINO" "QUATSINO" "QUATSINO" "QUATSINO" ...
 $ station_id        : num [1:421408] 271 271 271 271 271 271 271 271 271 271 ...
 $ station_operator  : logi [1:421408] NA NA NA NA NA NA ...
 $ prov              : chr [1:421408] "BC" "BC" "BC" "BC" ...
 $ lat               : num [1:421408] 50.5 50.5 50.5 50.5 50.5 ...
 $ lon               : num [1:421408] -128 -128 -128 -128 -128 ...
 $ elev              : num [1:421408] 3.4 3.4 3.4 3.4 3.4 3.4 3.4 3.4 3.4 3.4 ...
 $ climate_id        : chr [1:421408] "1036570" "1036570" "1036570" "1036570" ...
 $ WMO_id            : chr [1:421408] NA NA NA NA ...
 $ TC_id             : chr [1:421408] NA NA NA NA ...
 $ date              : Date[1:421408], format: "1895-01-01" "1895-01-02" ...
 $ year              : chr [1:421408] "1895" "1895" "1895" "1895" ...
 $ month             : chr [1:421408] "01" "01" "01" "01" ...
 $ day               : chr [1:421408] "01" "02" "03" "04" ...
 $ qual              : chr [1:421408] NA NA NA NA ...
 $ cool_deg_days     : num [1:421408] NA NA NA NA NA NA NA NA NA NA ...
 $ cool_deg_days_flag: chr [1:421408] NA NA NA NA ...
 $ dir_max_gust      : num [1:421408] NA NA NA NA NA NA NA NA NA NA ...
 $ dir_max_gust_flag : chr [1:421408] NA NA NA NA ...
 $ heat_deg_days     : num [1:421408] NA NA NA NA NA NA NA NA NA NA ...
 $ heat_deg_days_flag: chr [1:421408] NA NA NA NA ...
 $ max_temp          : num [1:421408] NA NA NA NA NA NA NA NA NA NA ...
 $ max_temp_flag     : chr [1:421408] NA NA NA NA ...
 $ mean_temp         : num [1:421408] NA NA NA NA NA NA NA NA NA NA ...
 $ mean_temp_flag    : chr [1:421408] NA NA NA NA ...
 $ min_temp          : num [1:421408] NA NA NA NA NA NA NA NA NA NA ...
 $ min_temp_flag     : chr [1:421408] NA NA NA NA ...
 $ snow_grnd         : num [1:421408] NA NA NA NA NA NA NA NA NA NA ...
 $ snow_grnd_flag    : chr [1:421408] NA NA NA NA ...
 $ spd_max_gust      : num [1:421408] NA NA NA NA NA NA NA NA NA NA ...
 $ spd_max_gust_flag : chr [1:421408] NA NA NA NA ...
 $ total_precip      : num [1:421408] NA NA NA NA NA NA NA NA NA NA ...
 $ total_precip_flag : chr [1:421408] NA NA NA NA ...
 $ total_rain        : num [1:421408] NA NA NA NA NA NA NA NA NA NA ...
 $ total_rain_flag   : chr [1:421408] NA NA NA NA ...
 $ total_snow        : num [1:421408] NA NA NA NA NA NA NA NA NA NA ...
 $ total_snow_flag   : chr [1:421408] NA NA NA NA ...
> 
> # time variables setup
> data <- data %>% mutate(date = as.Date(date),
+                         year = as.integer(year),
+                         month = as.integer(month),
+                         day = as.integer(day))
> 
> data <- data %>% mutate(time = as.integer(date),
+                         yday = lubridate::yday(date),
+                         week = lubridate::week(date))
> 
> # stations we look at
> stns_id <- c(568, 4333, 5051)
> p <- 3
> data <- data %>%
+   filter(station_id %in% stns_id) %>%
+   arrange(station_id, date)
> 
> # quick look at summary of the data (clearly shows time trends)
> data0 <- data %>% group_by(station_name, year) %>%
+   summarise(mm_temp = mean(mean_temp, na.rm=T))
`summarise()` has grouped output by 'station_name'. You can override using the
`.groups` argument.
> ggplot(data0, aes(x=year, y=mm_temp)) +
+   geom_line() +
+   geom_point() +
+   facet_wrap(~station_name)
Warning messages:
1: Removed 20 row(s) containing missing values (geom_path). 
2: Removed 25 rows containing missing values (geom_point). 
> 
> 
> # Estimate mean conditional on time of year -------------------------------
> year_len <- 365 + 6/24 + 9/60/24 + 9/60^2/24
> 
> # create sines-cosines basis (for seasonal trend)
> nSC <- 24
> s_cols <- paste0("s", 1:nSC)
> c_cols <- paste0("c", 1:nSC)
> for (i in 1:nSC) data <- data %>%
+   mutate(!!s_cols[i] := sin(i*2*pi*time/year_len),
+          !!c_cols[i] := cos(i*2*pi*time/year_len))
> 
> 
> # create natural spline basis (for long term time trend)
> # for this check range for each station
> row_ids <- sapply(stns_id, \(id) data$station_id == id)
> bss <- lapply(1:p, \(k){
+   data[row_ids[,k],] %>% filter(day == 21, month %in% c(6,12)) %>% select(time) %>% unlist
+ })
> 
> for(b in paste("b", 1:max(sapply(bss, length)))) data <- data %>% mutate(!!b := NA)
> nB <- rep(0, p); b_cols <- list()
> for(k in 1:p){
+   B <- splines::bs(data[row_ids[,k],]$time, knots = c(bss[[k]]), degree = 2)
+   B <- B[,colSums(abs(B[!is.na(data[row_ids[,k],]$mean_temp),])) > 1e-5]
+   nB[k] <- ncol(B)
+   b_cols[[length(b_cols)+1]] <- paste0("b", 1:nB[k])
+   data[row_ids[,k],b_cols[[k]]] <- B
+   rm(B)
+ }
> 
> 
> # fit least-squares
> non_na <- !is.na(data$mean_temp) # for later
> lms <- lapply(1:p, \(k){
+   x_cols <- c("mean_temp", s_cols, c_cols, b_cols[[k]])
+   lm(formula = "mean_temp~.", data = data[row_ids[,k],x_cols])
+ })
> 
> # Bakerville
> summary(lms[[1]])

Call:
lm(formula = "mean_temp~.", data = data[row_ids[, k], x_cols])

Residuals:
     Min       1Q   Median       3Q      Max 
-31.6187  -2.4403   0.2486   2.9926  18.3679 

Coefficients:
              Estimate Std. Error t value Pr(>|t|)    
(Intercept)   9.130928   2.127456   4.292 1.77e-05 ***
s1           -9.224653   3.815578  -2.418 0.015626 *  
s2            0.571225   0.031696  18.022  < 2e-16 ***
s3           -0.126507   0.124991  -1.012 0.311480    
s4            0.232337   0.031470   7.383 1.58e-13 ***
s5           -0.211271   0.036213  -5.834 5.44e-09 ***
s6           -0.095367   0.031454  -3.032 0.002431 ** 
s7           -0.077070   0.031555  -2.442 0.014594 *  
s8            0.003081   0.031438   0.098 0.921941    
s9           -0.036690   0.031437  -1.167 0.243169    
s10           0.065750   0.031411   2.093 0.036338 *  
s11           0.069833   0.031436   2.221 0.026327 *  
s12           0.004695   0.031399   0.150 0.881147    
s13          -0.023372   0.031443  -0.743 0.457286    
s14          -0.040444   0.031406  -1.288 0.197823    
s15           0.008346   0.031434   0.265 0.790627    
s16          -0.034076   0.031406  -1.085 0.277907    
s17           0.014550   0.031423   0.463 0.643342    
s18          -0.076674   0.031408  -2.441 0.014642 *  
s19          -0.037045   0.031419  -1.179 0.238373    
s20          -0.010013   0.031416  -0.319 0.749933    
s21          -0.004417   0.031423  -0.141 0.888222    
s22           0.028895   0.031411   0.920 0.357631    
s23          -0.015411   0.031396  -0.491 0.623516    
s24          -0.020090   0.031397  -0.640 0.522268    
c1          -11.397441   0.737984 -15.444  < 2e-16 ***
c2           -0.316887   0.031678 -10.003  < 2e-16 ***
c3           -0.151332   0.084174  -1.798 0.072208 .  
c4           -0.117399   0.031500  -3.727 0.000194 ***
c5            0.110619   0.040401   2.738 0.006183 ** 
c6           -0.127637   0.031440  -4.060 4.92e-05 ***
c7           -0.082109   0.033319  -2.464 0.013731 *  
c8           -0.086414   0.031416  -2.751 0.005950 ** 
c9           -0.011660   0.031866  -0.366 0.714426    
c10           0.032355   0.031420   1.030 0.303134    
c11          -0.011103   0.031524  -0.352 0.724679    
c12          -0.106082   0.031424  -3.376 0.000736 ***
c13          -0.097693   0.031424  -3.109 0.001879 ** 
c14          -0.042649   0.031412  -1.358 0.174554    
c15          -0.037152   0.031406  -1.183 0.236832    
c16          -0.024988   0.031415  -0.795 0.426380    
c17          -0.077378   0.031407  -2.464 0.013755 *  
c18          -0.035768   0.031411  -1.139 0.254831    
c19           0.018196   0.031405   0.579 0.562333    
c20           0.019072   0.031400   0.607 0.543602    
c21           0.021696   0.031393   0.691 0.489513    
c22           0.025106   0.031402   0.800 0.423995    
c23          -0.001502   0.031417  -0.048 0.961874    
c24          -0.044345   0.031413  -1.412 0.158056    
b1            3.319933   6.233525   0.533 0.594318    
b2          -16.570621   8.750915  -1.894 0.058286 .  
b3            5.861812   6.645591   0.882 0.377749    
b4          -17.671642   8.871071  -1.992 0.046371 *  
b5            3.008876   6.643190   0.453 0.650604    
b6          -16.852244   8.880499  -1.898 0.057746 .  
b7            3.175085   6.653160   0.477 0.633201    
b8          -17.004566   8.876251  -1.916 0.055405 .  
b9            3.445158   6.657872   0.517 0.604840    
b10         -17.489006   8.867701  -1.972 0.048591 *  
b11           3.229338   6.658815   0.485 0.627699    
b12         -18.847629   8.908446  -2.116 0.034376 *  
b13           4.263183   6.649758   0.641 0.521459    
b14         -17.940905   8.886658  -2.019 0.043508 *  
b15           4.955312   6.651897   0.745 0.456308    
b16         -18.505848   8.870381  -2.086 0.036961 *  
b17           4.533161   6.641343   0.683 0.494884    
b18         -19.190958   8.870663  -2.163 0.030514 *  
b19           5.002386   6.654655   0.752 0.452228    
b20         -17.876910   8.895034  -2.010 0.044462 *  
b21           5.832985   6.667090   0.875 0.381637    
b22         -17.014940   8.890640  -1.914 0.055652 .  
b23           1.281159   6.662804   0.192 0.847520    
b24         -17.882215   8.897861  -2.010 0.044467 *  
b25           8.132743   6.666451   1.220 0.222490    
b26         -20.070515   8.899665  -2.255 0.024126 *  
b27           4.967281   6.667104   0.745 0.456249    
b28         -17.877093   8.899459  -2.009 0.044566 *  
b29           6.422259   6.665670   0.963 0.335310    
b30         -20.590351   8.895508  -2.315 0.020634 *  
b31           4.983584   6.656335   0.749 0.454043    
b32         -19.732521   8.873119  -2.224 0.026163 *  
b33           3.623918   6.643374   0.545 0.585417    
b34         -17.786811   8.872879  -2.005 0.045009 *  
b35           7.291721   6.655859   1.096 0.273289    
b36         -20.916330   8.894541  -2.352 0.018698 *  
b37           8.069639   6.663690   1.211 0.225907    
b38         -19.808230   8.894880  -2.227 0.025957 *  
b39           0.897369   6.666745   0.135 0.892926    
b40         -16.279798   8.874528  -1.834 0.066595 .  
b41           3.404989   6.643947   0.512 0.608307    
b42         -18.069081   8.872974  -2.036 0.041714 *  
b43           3.394104   6.655924   0.510 0.610098    
b44         -21.937080   8.894550  -2.466 0.013653 *  
b45           5.346438   6.663611   0.802 0.422364    
b46         -21.301593   8.894604  -2.395 0.016629 *  
b47           4.103744   6.655953   0.617 0.537533    
b48         -21.574532   8.872957  -2.431 0.015041 *  
b49           6.213965   6.643319   0.935 0.349602    
b50         -20.336920   8.872878  -2.292 0.021908 *  
b51           3.063728   6.655868   0.460 0.645300    
b52         -19.874504   8.894549  -2.234 0.025458 *  
b53           6.555589   6.663607   0.984 0.325224    
b54         -21.580065   8.894605  -2.426 0.015262 *  
b55           9.265840   6.655951   1.392 0.163895    
b56         -21.276237   8.872958  -2.398 0.016495 *  
b57           2.142259   6.643326   0.322 0.747100    
b58         -19.153688   8.872893  -2.159 0.030881 *  
b59           0.921796   6.655883   0.138 0.889851    
b60         -18.070359   8.894562  -2.032 0.042198 *  
b61           3.736972   6.663614   0.561 0.574935    
b62         -18.049938   8.894608  -2.029 0.042432 *  
b63           4.320301   6.655949   0.649 0.516284    
b64         -21.322994   8.872958  -2.403 0.016259 *  
b65           3.808839   6.643332   0.573 0.566422    
b66         -20.108972   8.872906  -2.266 0.023436 *  
b67           5.646665   6.655896   0.848 0.396236    
b68         -21.126036   8.894572  -2.375 0.017546 *  
b69           2.356422   6.663619   0.354 0.723622    
b70         -18.171875   8.894609  -2.043 0.041056 *  
b71           3.539129   6.655946   0.532 0.594920    
b72         -17.302134   8.872957  -1.950 0.051184 .  
b73           5.876159   6.643336   0.885 0.376421    
b74         -20.811982   8.872917  -2.346 0.019003 *  
b75           5.802315   6.655908   0.872 0.383347    
b76         -20.234647   8.894583  -2.275 0.022914 *  
b77           9.926725   6.663625   1.490 0.136313    
b78         -21.974602   8.894613  -2.471 0.013494 *  
b79           5.935414   6.655952   0.892 0.372534    
b80         -21.407558   8.872980  -2.413 0.015840 *  
b81           5.362535   6.643398   0.807 0.419557    
b82         -18.632656   8.873095  -2.100 0.035743 *  
b83           2.992214   6.656389   0.450 0.653055    
b84         -18.911751   8.894530  -2.126 0.033490 *  
b85           2.860144   6.663595   0.429 0.667766    
b86         -18.147284   8.894590  -2.040 0.041330 *  
b87           7.711205   6.655930   1.159 0.246647    
b88         -20.950586   8.872949  -2.361 0.018221 *  
b89           4.565206   6.643341   0.687 0.491970    
b90         -19.249622   8.872941  -2.169 0.030052 *  
b91           6.148973   6.655938   0.924 0.355578    
b92         -23.576648   8.894626  -2.651 0.008036 ** 
b93           9.177236   6.663686   1.377 0.168457    
b94         -22.414104   8.894768  -2.520 0.011742 *  
b95           2.776341   6.656303   0.417 0.676608    
b96         -18.815790   8.874015  -2.120 0.033984 *  
b97           1.684188   6.646186   0.253 0.799955    
b98         -18.945661   8.872092  -2.135 0.032732 *  
b99           1.557343   6.655498   0.234 0.814991    
b100        -16.704135   8.894320  -1.878 0.060378 .  
b101          5.064213   6.663515   0.760 0.447264    
b102        -18.099210   8.894542  -2.035 0.041870 *  
b103          3.917679   6.655899   0.589 0.556131    
b104        -18.462182   8.872928  -2.081 0.037464 *  
b105          6.745789   6.643336   1.015 0.309910    
b106        -21.466090   8.872947  -2.419 0.015555 *  
b107          9.457377   6.655940   1.421 0.155355    
b108        -21.422168   8.894605  -2.408 0.016025 *  
b109          5.037787   6.663624   0.756 0.449645    
b110        -19.580793   8.894592  -2.201 0.027711 *  
b111          1.055209   6.655912   0.159 0.874034    
b112        -18.268948   8.872932  -2.059 0.039505 *  
b113          5.104826   6.643341   0.768 0.442246    
b114        -18.470906   8.872965  -2.082 0.037375 *  
b115          5.075723   6.655968   0.763 0.445717    
b116        -22.687834   8.894668  -2.551 0.010753 *  
b117          6.850777   6.663747   1.028 0.303924    
b118        -23.066524   8.894921  -2.593 0.009511 ** 
b119          7.109500   6.656667   1.068 0.285514    
b120        -20.172790   8.875078  -2.273 0.023033 *  
b121          4.786162   6.649971   0.720 0.471697    
b122        -17.569213   8.896130  -1.975 0.048283 *  
b123         -5.891594   6.896723  -0.854 0.392966    
b124         32.988711  90.062489   0.366 0.714153    
b125        -49.538050  28.252779  -1.753 0.079543 .  
b126        -20.510359   9.021644  -2.273 0.023003 *  
b127          2.288465   6.675574   0.343 0.731742    
b128        -16.541333   8.882429  -1.862 0.062574 .  
b129          3.305489   6.659717   0.496 0.619656    
b130        -16.846553   8.896045  -1.894 0.058270 .  
b131          0.640394   6.664233   0.096 0.923446    
b132        -17.831949   8.894821  -2.005 0.044995 *  
b133          3.426328   6.655986   0.515 0.606714    
b134        -22.715360   8.872944  -2.560 0.010468 *  
b135          2.780491   6.643342   0.419 0.675556    
b136        -19.710030   8.872967  -2.221 0.026332 *  
b137          2.517202   6.655955   0.378 0.705293    
b138        -19.675218   8.894608  -2.212 0.026969 *  
b139          8.554913   6.663603   1.284 0.199209    
b140        -19.971657   8.894553  -2.245 0.024749 *  
b141          4.731319   6.655857   0.711 0.477181    
b142        -21.370079   8.872883  -2.408 0.016024 *  
b143          4.656167   6.643313   0.701 0.483381    
b144        -20.120925   8.872957  -2.268 0.023354 *  
b145          7.630964   6.655951   1.146 0.251600    
b146        -20.440061   8.894604  -2.298 0.021565 *  
b147          2.151376   6.663595   0.323 0.746806    
b148        -17.490297   8.894545  -1.966 0.049258 *  
b149          4.876029   6.655853   0.733 0.463811    
b150        -18.640686   8.872900  -2.101 0.035659 *  
b151          4.237735   6.643402   0.638 0.523551    
b152        -21.622750   8.873271  -2.437 0.014820 *  
b153          2.607869   6.659392   0.392 0.695350    
b154        -18.694007   8.895093  -2.102 0.035593 *  
b155          2.961213   6.663910   0.444 0.656780    
b156        -18.705906   8.894584  -2.103 0.035466 *  
b157          3.480960   6.655843   0.523 0.600982    
b158        -18.572399   8.872859  -2.093 0.036340 *  
b159          6.030042   6.643296   0.908 0.364048    
b160        -22.755775   8.872952  -2.565 0.010332 *  
b161          3.303416   6.655945   0.496 0.619678    
b162        -18.019179   8.894592  -2.026 0.042785 *  
b163          5.762673   6.663571   0.865 0.387152    
b164        -21.488451   8.894509  -2.416 0.015699 *  
b165          4.934974   6.655802   0.741 0.458422    
b166        -20.659875   8.872832  -2.328 0.019893 *  
b167          2.321291   6.643278   0.349 0.726776    
b168        -20.886565   8.872942  -2.354 0.018579 *  
b169          5.296637   6.655932   0.796 0.426166    
b170        -21.311945   8.894568  -2.396 0.016576 *  
b171          3.457616   6.663520   0.519 0.603842    
b172        -18.097840   8.894408  -2.035 0.041883 *  
b173          1.306955   6.655589   0.196 0.844322    
b174        -18.384634   8.872425  -2.072 0.038261 *  
b175          5.238057   6.642607   0.789 0.430377    
b176        -19.018218   8.871806  -2.144 0.032065 *  
b177          8.034251   6.652882   1.208 0.227194    
b178        -22.309195   8.887675  -2.510 0.012072 *  
b179          4.031138   6.651387   0.606 0.544478    
b180        -15.233179   8.883238  -1.715 0.086385 .  
b181          3.105304   6.770594   0.459 0.646491    
b182        -17.031174   8.903296  -1.913 0.055766 .  
b183          4.545148   6.655506   0.683 0.494664    
b184        -18.689915   8.877731  -2.105 0.035274 *  
b185          6.962353   6.657974   1.046 0.295698    
b186        -18.797205   8.895367  -2.113 0.034594 *  
b187          2.657364   6.663812   0.399 0.690061    
b188        -19.251963   8.895940  -2.164 0.030460 *  
b189          8.026291   6.655514   1.206 0.227839    
b190        -21.765259   8.871433  -2.453 0.014155 *  
b191          7.358052   6.643215   1.108 0.268039    
b192        -23.203447   8.873004  -2.615 0.008924 ** 
b193          6.013406   6.656553   0.903 0.366328    
b194        -22.535701   8.898431  -2.533 0.011327 *  
b195          5.717133   6.663688   0.858 0.390923    
b196        -20.131322   8.894445  -2.263 0.023618 *  
b197          8.145175   6.655699   1.224 0.221038    
b198        -19.356375   8.872726  -2.182 0.029147 *  
b199          5.431416   6.643243   0.818 0.413599    
b200        -19.036811   8.873530  -2.145 0.031930 *  
b201          3.360677   6.655927   0.505 0.613621    
b202        -18.116093   8.894508  -2.037 0.041679 *  
b203          5.904250   6.663467   0.886 0.375589    
b204        -20.374594   8.894420  -2.291 0.021984 *  
b205          4.772176   6.655686   0.717 0.473373    
b206        -19.829768   8.872937  -2.235 0.025432 *  
b207         10.326278   6.643244   1.554 0.120095    
b208        -22.183213   8.872858  -2.500 0.012419 *  
b209          5.171341   6.655762   0.777 0.437179    
b210        -19.128955   8.894192  -2.151 0.031503 *  
b211          6.858915   6.662730   1.029 0.303276    
b212        -19.958727   8.892643  -2.244 0.024811 *  
b213          5.920384   6.652192   0.890 0.373476    
b214        -19.749308   8.865971  -2.228 0.025916 *  
b215          2.515829   6.655320   0.378 0.705419    
b216        -21.135980   8.868191  -2.383 0.017160 *  
b217          3.974928   6.653827   0.597 0.550250    
b218        -19.348701   8.893396  -2.176 0.029588 *  
b219          7.467491   6.663254   1.121 0.262423    
b220        -18.354169   8.894173  -2.064 0.039060 *  
b221          4.439451   6.655529   0.667 0.504755    
b222        -19.201214   8.872923  -2.164 0.030468 *  
b223          5.068561   6.643355   0.763 0.445496    
b224        -19.834766   8.872884  -2.235 0.025394 *  
b225          4.300699   6.656039   0.646 0.518195    
b226        -18.552654   8.894490  -2.086 0.036997 *  
b227          2.283700   6.663346   0.343 0.731806    
b228        -18.582350   8.894498  -2.089 0.036696 *  
b229          6.997022   6.655410   1.051 0.293113    
b230        -21.224211   8.872058  -2.392 0.016749 *  
b231          7.200101   6.642077   1.084 0.278365    
b232        -20.391684   8.871372  -2.299 0.021533 *  
b233          6.968627   6.658357   1.047 0.295290    
b234        -20.532970   8.894761  -2.308 0.020980 *  
b235          6.809469   6.661897   1.022 0.306715    
b236        -19.884599   8.890108  -2.237 0.025310 *  
b237          6.087096   6.647929   0.916 0.359862    
b238        -19.568712   8.874525  -2.205 0.027456 *  
b239          3.116135   6.652810   0.468 0.639505    
b240        -18.684914   8.878613  -2.104 0.035342 *  
b241          1.171802   6.654300   0.176 0.860219    
b242        -14.812327   8.900604  -1.664 0.096081 .  
b243          6.878477   6.659487   1.033 0.301664    
b244        -21.142872   8.888201  -2.379 0.017375 *  
b245          2.507521   6.682661   0.375 0.707493    
b246        -19.337188   8.893619  -2.174 0.029690 *  
b247          4.296919   6.664410   0.645 0.519089    
b248        -18.011253   8.877356  -2.029 0.042475 *  
b249          4.832061   6.661198   0.725 0.468208    
b250        -17.266305   8.892258  -1.942 0.052177 .  
b251          2.666266   6.643864   0.401 0.688192    
b252        -17.789029   8.875924  -2.004 0.045056 *  
b253          8.023910   6.648734   1.207 0.227503    
b254          3.433350  14.580537   0.235 0.813841    
b255        -26.223272  21.063809  -1.245 0.213159    
b256        -17.348086   9.047677  -1.917 0.055193 .  
b257          4.518252   6.697537   0.675 0.499925    
b258        -17.867113   8.903382  -2.007 0.044779 *  
b259          2.463421   6.657022   0.370 0.711348    
b260        -16.734484   8.867463  -1.887 0.059143 .  
b261          1.725070   6.602391   0.261 0.793878    
b262         -4.533800   3.398216  -1.334 0.182155    
b263          3.283539  87.572683   0.037 0.970090    
---
Signif. codes:  0 ‘***’ 0.001 ‘**’ 0.01 ‘*’ 0.05 ‘.’ 0.1 ‘ ’ 1

Residual standard error: 4.706 on 44607 degrees of freedom
  (4601 observations deleted due to missingness)
Multiple R-squared:  0.7268,	Adjusted R-squared:  0.7249 
F-statistic: 381.5 on 311 and 44607 DF,  p-value: < 2.2e-16

> # Ottawa
> summary(lms[[2]])

Call:
lm(formula = "mean_temp~.", data = data[row_ids[, k], x_cols])

Residuals:
     Min       1Q   Median       3Q      Max 
-21.6145  -2.9993  -0.0337   3.0446  18.9390 

Coefficients: (1 not defined because of singularities)
              Estimate Std. Error t value Pr(>|t|)    
(Intercept)   3.550371   8.481795   0.419 0.675520    
s1          -32.652611   3.804325  -8.583  < 2e-16 ***
s2           -1.048524   0.030280 -34.628  < 2e-16 ***
s3           -1.207576   0.123980  -9.740  < 2e-16 ***
s4            0.162519   0.030223   5.377 7.60e-08 ***
s5            0.032721   0.035076   0.933 0.350907    
s6            0.091520   0.030231   3.027 0.002468 ** 
s7            0.067791   0.030334   2.235 0.025431 *  
s8            0.100440   0.030218   3.324 0.000889 ***
s9            0.029039   0.030234   0.960 0.336828    
s10          -0.002316   0.030219  -0.077 0.938919    
s11          -0.042155   0.030253  -1.393 0.163502    
s12          -0.125133   0.030215  -4.141 3.46e-05 ***
s13          -0.080658   0.030255  -2.666 0.007679 ** 
s14          -0.053852   0.030222  -1.782 0.074770 .  
s15          -0.005356   0.030236  -0.177 0.859386    
s16          -0.048195   0.030215  -1.595 0.110707    
s17           0.083381   0.030226   2.759 0.005807 ** 
s18           0.118290   0.030219   3.914 9.08e-05 ***
s19          -0.018844   0.030223  -0.623 0.532960    
s20          -0.044845   0.030218  -1.484 0.137804    
s21           0.030323   0.030218   1.003 0.315628    
s22           0.079634   0.030217   2.635 0.008407 ** 
s23           0.086605   0.030214   2.866 0.004153 ** 
s24           0.037955   0.030218   1.256 0.209101    
c1          -20.243414   0.739753 -27.365  < 2e-16 ***
c2           -0.749498   0.030395 -24.659  < 2e-16 ***
c3           -0.621123   0.083759  -7.416 1.23e-13 ***
c4           -0.050454   0.030248  -1.668 0.095318 .  
c5           -0.240573   0.039390  -6.108 1.02e-09 ***
c6            0.169440   0.030219   5.607 2.07e-08 ***
c7            0.021896   0.032148   0.681 0.495813    
c8            0.022468   0.030224   0.743 0.457257    
c9            0.008496   0.030671   0.277 0.781775    
c10           0.029454   0.030218   0.975 0.329706    
c11          -0.052215   0.030324  -1.722 0.085091 .  
c12           0.033312   0.030221   1.102 0.270342    
c13           0.066838   0.030230   2.211 0.027045 *  
c14           0.015539   0.030212   0.514 0.607036    
c15           0.065438   0.030218   2.166 0.030352 *  
c16          -0.031444   0.030217  -1.041 0.298066    
c17           0.037912   0.030216   1.255 0.209591    
c18           0.061190   0.030212   2.025 0.042840 *  
c19          -0.087773   0.030214  -2.905 0.003674 ** 
c20           0.012275   0.030213   0.406 0.684548    
c21           0.035490   0.030216   1.175 0.240193    
c22          -0.102816   0.030213  -3.403 0.000667 ***
c23          -0.110256   0.030218  -3.649 0.000264 ***
c24          -0.101441   0.030213  -3.358 0.000787 ***
b1          -93.144083  55.798467  -1.669 0.095065 .  
b2          -43.503138   9.321455  -4.667 3.06e-06 ***
b3           53.327050  12.919148   4.128 3.67e-05 ***
b4          -51.982816   9.361479  -5.553 2.83e-08 ***
b5           54.321850  12.991309   4.181 2.90e-05 ***
b6          -49.842928   9.372261  -5.318 1.05e-07 ***
b7           55.098508  12.996082   4.240 2.24e-05 ***
b8          -51.719045   9.376279  -5.516 3.49e-08 ***
b9           52.995433  13.008929   4.074 4.63e-05 ***
b10         -51.493110   9.388492  -5.485 4.16e-08 ***
b11          56.153877  13.016091   4.314 1.61e-05 ***
b12         -51.592924   9.388923  -5.495 3.92e-08 ***
b13          55.656121  13.010272   4.278 1.89e-05 ***
b14         -52.008705   9.377709  -5.546 2.94e-08 ***
b15          55.332664  12.999823   4.256 2.08e-05 ***
b16         -51.595130   9.377549  -5.502 3.77e-08 ***
b17          56.374848  13.010406   4.333 1.47e-05 ***
b18         -52.511614   9.389923  -5.592 2.25e-08 ***
b19          57.874992  13.020395   4.445 8.81e-06 ***
b20         -50.857664   9.395891  -5.413 6.24e-08 ***
b21          54.596602  13.033758   4.189 2.81e-05 ***
b22         -50.214867   9.391973  -5.347 9.00e-08 ***
b23          55.162349  13.020053   4.237 2.27e-05 ***
b24         -50.228535   9.392460  -5.348 8.95e-08 ***
b25          55.730092  13.020544   4.280 1.87e-05 ***
b26         -51.353451   9.392364  -5.468 4.58e-08 ***
b27          57.385518  13.019392   4.408 1.05e-05 ***
b28         -53.802032   9.390309  -5.730 1.01e-08 ***
b29          59.128655  13.011788   4.544 5.53e-06 ***
b30         -54.288956   9.378590  -5.789 7.14e-09 ***
b31          54.076700  13.001194   4.159 3.20e-05 ***
b32         -52.892618   9.378447  -5.640 1.71e-08 ***
b33          52.911269  13.011362   4.067 4.78e-05 ***
b34         -50.806342   9.389784  -5.411 6.30e-08 ***
b35          55.884954  13.017699   4.293 1.77e-05 ***
b36         -50.804916   9.389835  -5.411 6.31e-08 ***
b37          52.323736  13.011478   4.021 5.80e-05 ***
b38         -51.582390   9.378506  -5.500 3.82e-08 ***
b39          53.969278  13.001146   4.151 3.31e-05 ***
b40         -49.259463   9.378442  -5.252 1.51e-07 ***
b41          54.351174  13.011368   4.177 2.96e-05 ***
b42         -51.813584   9.389791  -5.518 3.44e-08 ***
b43          59.031500  13.017707   4.535 5.78e-06 ***
b44         -53.595235   9.389839  -5.708 1.15e-08 ***
b45          55.500509  13.011481   4.266 2.00e-05 ***
b46         -49.657095   9.378509  -5.295 1.20e-07 ***
b47          52.285969  13.001156   4.022 5.79e-05 ***
b48         -50.103921   9.378452  -5.342 9.21e-08 ***
b49          56.374828  13.011384   4.333 1.48e-05 ***
b50         -50.433009   9.389800  -5.371 7.86e-08 ***
b51          55.250890  13.017716   4.244 2.20e-05 ***
b52         -51.653210   9.389842  -5.501 3.80e-08 ***
b53          56.828556  13.011484   4.368 1.26e-05 ***
b54         -50.487381   9.378512  -5.383 7.35e-08 ***
b55          54.112116  13.001164   4.162 3.16e-05 ***
b56         -50.139693   9.378461  -5.346 9.02e-08 ***
b57          53.238854  13.011399   4.092 4.29e-05 ***
b58         -52.956153   9.389808  -5.640 1.71e-08 ***
b59          53.637612  13.017724   4.120 3.79e-05 ***
b60         -51.156308   9.389846  -5.448 5.12e-08 ***
b61          57.678651  13.011485   4.433 9.32e-06 ***
b62         -52.261236   9.378514  -5.572 2.53e-08 ***
b63          54.221293  13.001172   4.170 3.04e-05 ***
b64         -50.459296   9.378470  -5.380 7.47e-08 ***
b65          59.446249  13.011411   4.569 4.92e-06 ***
b66         -51.520634   9.389816  -5.487 4.11e-08 ***
b67          56.209897  13.017727   4.318 1.58e-05 ***
b68         -50.205093   9.389859  -5.347 9.00e-08 ***
b69          51.709134  13.011494   3.974 7.07e-05 ***
b70         -49.171511   9.378519  -5.243 1.59e-07 ***
b71          54.789643  13.001183   4.214 2.51e-05 ***
b72         -52.434554   9.378478  -5.591 2.27e-08 ***
b73          56.652821  13.011425   4.354 1.34e-05 ***
b74         -52.549882   9.389823  -5.596 2.20e-08 ***
b75          53.340653  13.017737   4.098 4.18e-05 ***
b76         -53.045178   9.389850  -5.649 1.62e-08 ***
b77          55.809517  13.011485   4.289 1.80e-05 ***
b78         -51.283727   9.378516  -5.468 4.57e-08 ***
b79          54.899765  13.001183   4.223 2.42e-05 ***
b80         -52.298628   9.378485  -5.576 2.47e-08 ***
b81          55.691099  13.011436   4.280 1.87e-05 ***
b82         -53.145800   9.389829  -5.660 1.52e-08 ***
b83          55.835601  13.017742   4.289 1.80e-05 ***
b84         -51.795196   9.389851  -5.516 3.48e-08 ***
b85          56.249791  13.011483   4.323 1.54e-05 ***
b86         -48.928123   9.378516  -5.217 1.83e-07 ***
b87          55.488768  13.001187   4.268 1.98e-05 ***
b88         -52.496504   9.378491  -5.598 2.19e-08 ***
b89          59.066148  13.011446   4.540 5.65e-06 ***
b90         -54.594600   9.389834  -5.814 6.13e-09 ***
b91          51.090367  13.017745   3.925 8.70e-05 ***
b92         -50.324678   9.389851  -5.359 8.38e-08 ***
b93          53.066301  13.011480   4.078 4.54e-05 ***
b94         -51.639460   9.378515  -5.506 3.69e-08 ***
b95          54.214200  13.001190   4.170 3.05e-05 ***
b96         -52.495857   9.378497  -5.597 2.19e-08 ***
b97          57.466760  13.011455   4.417 1.00e-05 ***
b98         -52.275838   9.389839  -5.567 2.60e-08 ***
b99          55.093200  13.017748   4.232 2.32e-05 ***
b100        -50.354499   9.389850  -5.363 8.24e-08 ***
b101         53.104752  13.011476   4.081 4.48e-05 ***
b102        -51.416775   9.378513  -5.482 4.22e-08 ***
b103         53.189847  13.001192   4.091 4.30e-05 ***
b104        -52.297633   9.378502  -5.576 2.47e-08 ***
b105         55.693311  13.011461   4.280 1.87e-05 ***
b106        -52.102974   9.389841  -5.549 2.89e-08 ***
b107         58.053182  13.017740   4.460 8.23e-06 ***
b108        -52.776485   9.389848  -5.621 1.91e-08 ***
b109         53.458941  13.011539   4.109 3.99e-05 ***
b110        -51.873090   9.378536  -5.531 3.20e-08 ***
b111         55.599851  13.001226   4.277 1.90e-05 ***
b112        -51.277698   9.378565  -5.468 4.59e-08 ***
b113         55.288743  13.011734   4.249 2.15e-05 ***
b114        -52.016092   9.390723  -5.539 3.06e-08 ***
b115         55.198529  13.017869   4.240 2.24e-05 ***
b116        -50.547676   9.389875  -5.383 7.35e-08 ***
b117         53.531184  13.011478   4.114 3.89e-05 ***
b118        -49.342997   9.378511  -5.261 1.44e-07 ***
b119         52.448480  13.001195   4.034 5.49e-05 ***
b120        -48.122508   9.378510  -5.131 2.89e-07 ***
b121         56.784288  13.011475   4.364 1.28e-05 ***
b122        -50.325128   9.389849  -5.360 8.38e-08 ***
b123         55.041481  13.017748   4.228 2.36e-05 ***
b124        -52.308668   9.389846  -5.571 2.55e-08 ***
b125         58.110343  13.011457   4.466 7.98e-06 ***
b126        -53.148094   9.378522  -5.667 1.46e-08 ***
b127         57.654443  13.001224   4.435 9.25e-06 ***
b128        -51.659368   9.378517  -5.508 3.64e-08 ***
b129         59.190441  13.011498   4.549 5.40e-06 ***
b130        -51.402094   9.389898  -5.474 4.42e-08 ***
b131         57.413069  13.018009   4.410 1.03e-05 ***
b132        -53.454243   9.389876  -5.693 1.26e-08 ***
b133         57.157762  13.011461   4.393 1.12e-05 ***
b134        -49.620149   9.378503  -5.291 1.22e-07 ***
b135         53.722297  13.001190   4.132 3.60e-05 ***
b136        -52.485097   9.378515  -5.596 2.20e-08 ***
b137         57.212492  13.011483   4.397 1.10e-05 ***
b138        -51.625741   9.389851  -5.498 3.86e-08 ***
b139         58.233016  13.017743   4.473 7.72e-06 ***
b140        -54.117098   9.389836  -5.763 8.30e-09 ***
b141         55.096062  13.011437   4.234 2.30e-05 ***
b142        -49.551441   9.378494  -5.284 1.27e-07 ***
b143         55.159663  13.001184   4.243 2.21e-05 ***
b144        -50.181956   9.378515  -5.351 8.80e-08 ***
b145         54.561713  13.011485   4.193 2.75e-05 ***
b146        -49.856673   9.389851  -5.310 1.10e-07 ***
b147         56.233183  13.017738   4.320 1.57e-05 ***
b148        -52.310339   9.389831  -5.571 2.55e-08 ***
b149         54.849580  13.011426   4.215 2.50e-05 ***
b150        -51.236993   9.378487  -5.463 4.70e-08 ***
b151         57.465867  13.001179   4.420 9.89e-06 ***
b152        -52.557510   9.378516  -5.604 2.11e-08 ***
b153         56.204050  13.011485   4.320 1.57e-05 ***
b154        -52.274629   9.389850  -5.567 2.60e-08 ***
b155         57.427426  13.017732   4.411 1.03e-05 ***
b156        -51.609535   9.389825  -5.496 3.90e-08 ***
b157         55.561281  13.011414   4.270 1.96e-05 ***
b158        -51.889274   9.378481  -5.533 3.17e-08 ***
b159         56.354465  13.001173   4.335 1.46e-05 ***
b160        -50.816169   9.378516  -5.418 6.04e-08 ***
b161         56.201532  13.011485   4.319 1.57e-05 ***
b162        -51.435790   9.389849  -5.478 4.33e-08 ***
b163         54.521648  13.017726   4.188 2.82e-05 ***
b164        -49.724516   9.389819  -5.296 1.19e-07 ***
b165         53.004877  13.011401   4.074 4.63e-05 ***
b166        -49.065311   9.378473  -5.232 1.69e-07 ***
b167         53.955827  13.001166   4.150 3.33e-05 ***
b168        -52.274472   9.378515  -5.574 2.50e-08 ***
b169         57.631180  13.011484   4.429 9.48e-06 ***
b170        -50.450763   9.389847  -5.373 7.78e-08 ***
b171         55.451915  13.017718   4.260 2.05e-05 ***
b172        -52.355016   9.389811  -5.576 2.48e-08 ***
b173         58.301942  13.011386   4.481 7.45e-06 ***
b174        -51.631184   9.378465  -5.505 3.70e-08 ***
b175         57.422850  13.001157   4.417 1.00e-05 ***
b176        -54.417724   9.378513  -5.802 6.58e-09 ***
b177         58.206490  13.011481   4.473 7.71e-06 ***
b178        -52.369518   9.389844  -5.577 2.46e-08 ***
b179         55.587328  13.017709   4.270 1.96e-05 ***
b180        -51.734904   9.389803  -5.510 3.61e-08 ***
b181         56.846490  13.011371   4.369 1.25e-05 ***
b182        -51.528683   9.378455  -5.494 3.94e-08 ***
b183         58.734170  13.001147   4.518 6.27e-06 ***
b184        -54.925456   9.378510  -5.857 4.76e-09 ***
b185         58.773610  13.011478   4.517 6.29e-06 ***
b186        -52.744177   9.389840  -5.617 1.95e-08 ***
b187         55.687615  13.017698   4.278 1.89e-05 ***
b188        -50.968786   9.389794  -5.428 5.72e-08 ***
b189         58.114119  13.011354   4.466 7.97e-06 ***
b190        -51.321832   9.378446  -5.472 4.46e-08 ***
b191         55.616848  13.001137   4.278 1.89e-05 ***
b192        -50.712711   9.378507  -5.407 6.43e-08 ***
b193         56.889987  13.011473   4.372 1.23e-05 ***
b194        -52.322044   9.389836  -5.572 2.53e-08 ***
b195         58.883286  13.017687   4.523 6.10e-06 ***
b196        -54.231206   9.389785  -5.776 7.72e-09 ***
b197         60.439909  13.011336   4.645 3.41e-06 ***
b198        -53.092720   9.378435  -5.661 1.51e-08 ***
b199         58.844141  13.001125   4.526 6.02e-06 ***
b200        -52.354887   9.378503  -5.582 2.38e-08 ***
b201         57.901289  13.011467   4.450 8.61e-06 ***
b202        -53.125190   9.389831  -5.658 1.54e-08 ***
b203         58.356558  13.017675   4.483 7.38e-06 ***
b204        -52.391795   9.389775  -5.580 2.42e-08 ***
b205         60.024304  13.011317   4.613 3.97e-06 ***
b206        -51.217685   9.378424  -5.461 4.75e-08 ***
b207         55.275291  13.001112   4.252 2.13e-05 ***
b208        -52.307285   9.378498  -5.577 2.45e-08 ***
b209         56.780907  13.011460   4.364 1.28e-05 ***
b210        -52.017628   9.389825  -5.540 3.04e-08 ***
b211         54.261701  13.017661   4.168 3.07e-05 ***
b212        -49.889450   9.389764  -5.313 1.08e-07 ***
b213         58.964976  13.011297   4.532 5.86e-06 ***
b214        -52.387171   9.378412  -5.586 2.34e-08 ***
b215         55.499064  13.001098   4.269 1.97e-05 ***
b216        -50.347737   9.378493  -5.368 7.98e-08 ***
b217         56.751574  13.011452   4.362 1.29e-05 ***
b218        -53.013093   9.389818  -5.646 1.65e-08 ***
b219         61.256876  13.017646   4.706 2.54e-06 ***
b220        -51.371643   9.389752  -5.471 4.50e-08 ***
b221         59.678395  13.011276   4.587 4.52e-06 ***
b222        -50.166202   9.378399  -5.349 8.88e-08 ***
b223         58.993546  13.001082   4.538 5.70e-06 ***
b224        -52.720777   9.378487  -5.621 1.90e-08 ***
b225         56.923374  13.011443   4.375 1.22e-05 ***
b226        -48.077691   9.389811  -5.120 3.06e-07 ***
b227         58.888619  13.017630   4.524 6.09e-06 ***
b228        -51.333204   9.389739  -5.467 4.60e-08 ***
b229         55.406283  13.011253   4.258 2.06e-05 ***
b230        -49.941965   9.378385  -5.325 1.01e-07 ***
b231         56.884744  13.001066   4.375 1.21e-05 ***
b232        -51.090046   9.378480  -5.448 5.13e-08 ***
b233         56.832647  13.011432   4.368 1.26e-05 ***
b234        -49.071384   9.389803  -5.226 1.74e-07 ***
b235         59.015287  13.017613   4.533 5.82e-06 ***
b236        -50.737666   9.389726  -5.404 6.57e-08 ***
b237         57.939365  13.011230   4.453 8.49e-06 ***
b238        -50.804819   9.378371  -5.417 6.08e-08 ***
b239         58.132135  13.001048   4.471 7.79e-06 ***
b240        -52.798306   9.378472  -5.630 1.81e-08 ***
b241         57.955385  13.011421   4.454 8.44e-06 ***
b242        -53.066382   9.389794  -5.651 1.60e-08 ***
b243         62.997223  13.017595   4.839 1.31e-06 ***
b244        -52.588079   9.389712  -5.601 2.15e-08 ***
b245         58.165303  13.011205   4.470 7.83e-06 ***
b246        -49.497646   9.378356  -5.278 1.31e-07 ***
b247         61.118698  13.001030   4.701 2.60e-06 ***
b248        -50.885446   9.378464  -5.426 5.80e-08 ***
b249         58.466785  13.011408   4.494 7.02e-06 ***
b250        -51.595767   9.389784  -5.495 3.93e-08 ***
b251         55.012923  13.017575   4.226 2.38e-05 ***
b252        -49.651525   9.389695  -5.288 1.24e-07 ***
b253         53.744272  13.011173   4.131 3.62e-05 ***
b254        -47.012696   9.378332  -5.013 5.38e-07 ***
b255         57.320529  13.000977   4.409 1.04e-05 ***
b256        -49.152098   9.378412  -5.241 1.60e-07 ***
b257         58.183480  13.011227   4.472 7.77e-06 ***
b258        -51.121875   9.389644  -5.444 5.22e-08 ***
b259         58.514875  13.019040   4.495 6.99e-06 ***
b260        -50.979498   9.390019  -5.429 5.69e-08 ***
b261         55.861682  13.008542   4.294 1.76e-05 ***
b262        -51.819742   9.376737  -5.526 3.29e-08 ***
b263         61.189601  12.991193   4.710 2.48e-06 ***
b264        -50.900614   9.378750  -5.427 5.75e-08 ***
b265         59.679982  13.004720   4.589 4.46e-06 ***
b266        -49.783154   9.397799  -5.297 1.18e-07 ***
b267         58.089839  12.990477   4.472 7.78e-06 ***
b268        -50.390854   9.443017  -5.336 9.53e-08 ***
b269         61.328900  12.843573   4.775 1.80e-06 ***
b270         -9.294101   8.654064  -1.074 0.282847    
b271                NA         NA      NA       NA    
---
Signif. codes:  0 ‘***’ 0.001 ‘**’ 0.01 ‘*’ 0.05 ‘.’ 0.1 ‘ ’ 1

Residual standard error: 4.714 on 48357 degrees of freedom
  (478 observations deleted due to missingness)
Multiple R-squared:  0.8534,	Adjusted R-squared:  0.8524 
F-statistic: 885.2 on 318 and 48357 DF,  p-value: < 2.2e-16

> # Toronto
> summary(lms[[3]])

Call:
lm(formula = "mean_temp~.", data = data[row_ids[, k], x_cols])

Residuals:
     Min       1Q   Median       3Q      Max 
-20.1143  -2.6894   0.0135   2.7827  16.2955 

Coefficients:
              Estimate Std. Error t value Pr(>|t|)    
(Intercept)  1.252e+01  3.046e+00   4.109 3.98e-05 ***
s1           4.732e+00  1.786e+00   2.650 0.008058 ** 
s2          -1.074e-01  2.401e-02  -4.474 7.69e-06 ***
s3           5.829e-02  6.214e-02   0.938 0.348272    
s4           9.214e-02  2.398e-02   3.842 0.000122 ***
s5           2.005e-01  2.556e-02   7.844 4.44e-15 ***
s6           9.882e-02  2.398e-02   4.121 3.78e-05 ***
s7           2.724e-02  2.403e-02   1.134 0.256887    
s8           8.427e-02  2.398e-02   3.514 0.000441 ***
s9           3.008e-02  2.398e-02   1.254 0.209687    
s10         -3.467e-02  2.398e-02  -1.446 0.148188    
s11         -3.508e-02  2.398e-02  -1.463 0.143566    
s12         -3.669e-02  2.398e-02  -1.530 0.126022    
s13         -5.329e-02  2.398e-02  -2.222 0.026306 *  
s14         -2.551e-02  2.398e-02  -1.064 0.287352    
s15          2.990e-02  2.398e-02   1.247 0.212520    
s16         -3.055e-02  2.398e-02  -1.274 0.202561    
s17          8.617e-02  2.398e-02   3.593 0.000327 ***
s18          3.882e-02  2.398e-02   1.619 0.105452    
s19         -5.681e-02  2.398e-02  -2.369 0.017821 *  
s20         -3.934e-02  2.398e-02  -1.641 0.100847    
s21          1.397e-02  2.398e-02   0.583 0.560116    
s22          2.207e-02  2.398e-02   0.920 0.357413    
s23          5.049e-02  2.398e-02   2.106 0.035234 *  
s24          1.519e-02  2.398e-02   0.633 0.526411    
c1          -1.040e+01  3.314e-01 -31.377  < 2e-16 ***
c2           9.736e-03  2.403e-02   0.405 0.685422    
c3           3.066e-01  4.245e-02   7.222 5.17e-13 ***
c4           2.791e-02  2.398e-02   1.164 0.244484    
c5          -6.331e-02  2.660e-02  -2.380 0.017295 *  
c6           1.663e-01  2.398e-02   6.937 4.06e-12 ***
c7           7.849e-02  2.450e-02   3.203 0.001361 ** 
c8          -2.415e-02  2.398e-02  -1.007 0.313777    
c9           1.271e-02  2.411e-02   0.527 0.598048    
c10          1.056e-02  2.398e-02   0.440 0.659621    
c11         -7.137e-02  2.401e-02  -2.972 0.002956 ** 
c12          1.674e-02  2.398e-02   0.698 0.485128    
c13          9.990e-02  2.398e-02   4.165 3.11e-05 ***
c14          3.287e-02  2.398e-02   1.371 0.170423    
c15          5.502e-02  2.398e-02   2.295 0.021747 *  
c16          4.743e-02  2.398e-02   1.978 0.047944 *  
c17          7.580e-02  2.398e-02   3.161 0.001571 ** 
c18          5.113e-02  2.398e-02   2.132 0.032973 *  
c19          5.385e-03  2.398e-02   0.225 0.822316    
c20          2.006e-02  2.398e-02   0.837 0.402687    
c21          1.789e-02  2.398e-02   0.746 0.455628    
c22         -6.976e-02  2.398e-02  -2.910 0.003620 ** 
c23         -3.545e-02  2.398e-02  -1.479 0.139251    
c24         -4.578e-02  2.398e-02  -1.910 0.056200 .  
b1          -2.384e+01  4.532e+00  -5.260 1.45e-07 ***
b2           1.287e+01  4.972e+00   2.589 0.009629 ** 
b3          -2.505e+01  4.236e+00  -5.914 3.35e-09 ***
b4           1.363e+01  5.114e+00   2.666 0.007687 ** 
b5          -2.275e+01  4.190e+00  -5.429 5.68e-08 ***
b6           1.239e+01  5.139e+00   2.410 0.015950 *  
b7          -2.596e+01  4.179e+00  -6.213 5.22e-10 ***
b8           1.288e+01  5.135e+00   2.508 0.012135 *  
b9          -2.252e+01  4.173e+00  -5.397 6.82e-08 ***
b10          1.252e+01  5.136e+00   2.437 0.014793 *  
b11         -2.262e+01  4.176e+00  -5.415 6.15e-08 ***
b12          1.165e+01  5.144e+00   2.265 0.023532 *  
b13         -2.436e+01  4.179e+00  -5.830 5.59e-09 ***
b14          1.581e+01  5.144e+00   3.073 0.002121 ** 
b15         -2.671e+01  4.177e+00  -6.396 1.61e-10 ***
b16          1.333e+01  5.136e+00   2.595 0.009461 ** 
b17         -2.374e+01  4.172e+00  -5.690 1.28e-08 ***
b18          1.255e+01  5.136e+00   2.444 0.014510 *  
b19         -2.617e+01  4.176e+00  -6.267 3.70e-10 ***
b20          1.415e+01  5.144e+00   2.751 0.005942 ** 
b21         -2.409e+01  4.179e+00  -5.764 8.28e-09 ***
b22          1.233e+01  5.145e+00   2.397 0.016518 *  
b23         -2.386e+01  4.177e+00  -5.712 1.12e-08 ***
b24          1.211e+01  5.136e+00   2.358 0.018387 *  
b25         -2.722e+01  4.172e+00  -6.523 6.93e-11 ***
b26          1.413e+01  5.136e+00   2.752 0.005927 ** 
b27         -2.507e+01  4.176e+00  -6.003 1.94e-09 ***
b28          1.374e+01  5.144e+00   2.672 0.007551 ** 
b29         -2.642e+01  4.179e+00  -6.322 2.60e-10 ***
b30          1.558e+01  5.145e+00   3.028 0.002464 ** 
b31         -2.689e+01  4.177e+00  -6.437 1.23e-10 ***
b32          1.446e+01  5.136e+00   2.816 0.004869 ** 
b33         -2.886e+01  4.172e+00  -6.916 4.68e-12 ***
b34          1.472e+01  5.136e+00   2.866 0.004158 ** 
b35         -2.873e+01  4.176e+00  -6.879 6.07e-12 ***
b36          1.443e+01  5.144e+00   2.805 0.005031 ** 
b37         -2.504e+01  4.179e+00  -5.992 2.09e-09 ***
b38          1.393e+01  5.145e+00   2.707 0.006792 ** 
b39         -2.287e+01  4.177e+00  -5.476 4.37e-08 ***
b40          1.163e+01  5.136e+00   2.265 0.023517 *  
b41         -2.378e+01  4.172e+00  -5.700 1.20e-08 ***
b42          1.335e+01  5.136e+00   2.599 0.009352 ** 
b43         -2.612e+01  4.176e+00  -6.254 4.03e-10 ***
b44          1.471e+01  5.144e+00   2.858 0.004258 ** 
b45         -2.566e+01  4.179e+00  -6.141 8.27e-10 ***
b46          1.448e+01  5.145e+00   2.815 0.004882 ** 
b47         -2.433e+01  4.177e+00  -5.825 5.73e-09 ***
b48          1.326e+01  5.136e+00   2.582 0.009812 ** 
b49         -2.377e+01  4.172e+00  -5.697 1.23e-08 ***
b50          1.381e+01  5.136e+00   2.689 0.007161 ** 
b51         -2.538e+01  4.177e+00  -6.076 1.24e-09 ***
b52          1.540e+01  5.144e+00   2.993 0.002761 ** 
b53         -2.611e+01  4.179e+00  -6.247 4.22e-10 ***
b54          1.422e+01  5.145e+00   2.764 0.005717 ** 
b55         -2.585e+01  4.177e+00  -6.190 6.06e-10 ***
b56          1.507e+01  5.136e+00   2.934 0.003349 ** 
b57         -2.688e+01  4.172e+00  -6.443 1.18e-10 ***
b58          1.544e+01  5.136e+00   3.006 0.002652 ** 
b59         -2.641e+01  4.177e+00  -6.324 2.56e-10 ***
b60          1.271e+01  5.144e+00   2.471 0.013478 *  
b61         -2.362e+01  4.179e+00  -5.652 1.59e-08 ***
b62          1.501e+01  5.145e+00   2.917 0.003530 ** 
b63         -2.387e+01  4.177e+00  -5.715 1.10e-08 ***
b64          1.302e+01  5.136e+00   2.535 0.011261 *  
b65         -2.689e+01  4.172e+00  -6.446 1.16e-10 ***
b66          1.484e+01  5.136e+00   2.890 0.003857 ** 
b67         -2.841e+01  4.177e+00  -6.802 1.04e-11 ***
b68          1.480e+01  5.144e+00   2.878 0.004008 ** 
b69         -2.700e+01  4.179e+00  -6.460 1.06e-10 ***
b70          1.553e+01  5.145e+00   3.019 0.002537 ** 
b71         -2.969e+01  4.177e+00  -7.109 1.18e-12 ***
b72          1.399e+01  5.136e+00   2.725 0.006439 ** 
b73         -2.476e+01  4.172e+00  -5.935 2.96e-09 ***
b74          1.318e+01  5.136e+00   2.567 0.010260 *  
b75         -2.625e+01  4.177e+00  -6.284 3.32e-10 ***
b76          1.606e+01  5.145e+00   3.122 0.001796 ** 
b77         -2.192e+01  4.179e+00  -5.246 1.56e-07 ***
b78          1.474e+01  5.145e+00   2.865 0.004173 ** 
b79         -2.683e+01  4.177e+00  -6.425 1.33e-10 ***
b80          1.486e+01  5.136e+00   2.893 0.003813 ** 
b81         -2.230e+01  4.172e+00  -5.344 9.11e-08 ***
b82          1.280e+01  5.136e+00   2.492 0.012705 *  
b83         -2.756e+01  4.177e+00  -6.598 4.19e-11 ***
b84          1.865e+01  5.145e+00   3.624 0.000290 ***
b85         -2.564e+01  4.179e+00  -6.134 8.61e-10 ***
b86          1.531e+01  5.145e+00   2.975 0.002926 ** 
b87         -2.823e+01  4.177e+00  -6.758 1.41e-11 ***
b88          1.337e+01  5.136e+00   2.602 0.009266 ** 
b89         -2.654e+01  4.172e+00  -6.360 2.03e-10 ***
b90          1.538e+01  5.136e+00   2.995 0.002746 ** 
b91         -3.055e+01  4.177e+00  -7.314 2.62e-13 ***
b92          1.481e+01  5.145e+00   2.879 0.003995 ** 
b93         -2.549e+01  4.179e+00  -6.098 1.08e-09 ***
b94          1.334e+01  5.145e+00   2.593 0.009505 ** 
b95         -2.587e+01  4.177e+00  -6.194 5.89e-10 ***
b96          1.485e+01  5.136e+00   2.891 0.003840 ** 
b97         -2.825e+01  4.172e+00  -6.771 1.29e-11 ***
b98          1.470e+01  5.136e+00   2.861 0.004220 ** 
b99         -2.451e+01  4.177e+00  -5.869 4.40e-09 ***
b100         1.411e+01  5.145e+00   2.742 0.006113 ** 
b101        -2.276e+01  4.179e+00  -5.446 5.19e-08 ***
b102         1.267e+01  5.145e+00   2.463 0.013775 *  
b103        -2.421e+01  4.177e+00  -5.797 6.80e-09 ***
b104         1.445e+01  5.136e+00   2.814 0.004901 ** 
b105        -2.478e+01  4.172e+00  -5.940 2.87e-09 ***
b106         1.431e+01  5.136e+00   2.787 0.005325 ** 
b107        -2.685e+01  4.177e+00  -6.430 1.29e-10 ***
b108         1.487e+01  5.145e+00   2.890 0.003848 ** 
b109        -2.379e+01  4.179e+00  -5.692 1.26e-08 ***
b110         1.488e+01  5.145e+00   2.892 0.003834 ** 
b111        -2.539e+01  4.177e+00  -6.080 1.21e-09 ***
b112         1.382e+01  5.136e+00   2.692 0.007114 ** 
b113        -2.414e+01  4.173e+00  -5.784 7.31e-09 ***
b114         1.460e+01  5.136e+00   2.842 0.004478 ** 
b115        -2.429e+01  4.177e+00  -5.815 6.08e-09 ***
b116         1.484e+01  5.145e+00   2.884 0.003924 ** 
b117        -2.266e+01  4.180e+00  -5.421 5.93e-08 ***
b118         1.577e+01  5.147e+00   3.064 0.002183 ** 
b119        -2.567e+01  4.181e+00  -6.140 8.33e-10 ***
b120         1.647e+01  5.147e+00   3.201 0.001371 ** 
b121        -2.598e+01  4.181e+00  -6.213 5.22e-10 ***
b122         1.781e+01  5.147e+00   3.461 0.000539 ***
b123        -2.508e+01  4.181e+00  -5.999 1.99e-09 ***
b124         1.555e+01  5.147e+00   3.021 0.002519 ** 
b125        -2.399e+01  4.180e+00  -5.740 9.51e-09 ***
b126         1.358e+01  5.145e+00   2.639 0.008317 ** 
b127        -2.148e+01  4.177e+00  -5.143 2.71e-07 ***
b128         1.282e+01  5.137e+00   2.495 0.012587 *  
b129        -2.651e+01  4.173e+00  -6.353 2.13e-10 ***
b130         1.381e+01  5.137e+00   2.689 0.007168 ** 
b131        -2.652e+01  4.177e+00  -6.349 2.19e-10 ***
b132         1.612e+01  5.145e+00   3.133 0.001729 ** 
b133        -2.392e+01  4.180e+00  -5.723 1.05e-08 ***
b134         1.611e+01  5.145e+00   3.130 0.001747 ** 
b135        -2.648e+01  4.177e+00  -6.339 2.33e-10 ***
b136         1.454e+01  5.136e+00   2.830 0.004650 ** 
b137        -2.461e+01  4.173e+00  -5.898 3.70e-09 ***
b138         1.629e+01  5.137e+00   3.171 0.001522 ** 
b139        -2.359e+01  4.177e+00  -5.647 1.64e-08 ***
b140         1.372e+01  5.145e+00   2.666 0.007683 ** 
b141        -2.182e+01  4.179e+00  -5.220 1.80e-07 ***
b142         1.331e+01  5.145e+00   2.587 0.009675 ** 
b143        -2.275e+01  4.177e+00  -5.448 5.13e-08 ***
b144         1.574e+01  5.136e+00   3.065 0.002181 ** 
b145        -2.719e+01  4.173e+00  -6.516 7.29e-11 ***
b146         1.644e+01  5.137e+00   3.200 0.001373 ** 
b147        -2.305e+01  4.177e+00  -5.517 3.46e-08 ***
b148         1.579e+01  5.145e+00   3.069 0.002152 ** 
b149        -2.427e+01  4.179e+00  -5.808 6.37e-09 ***
b150         1.575e+01  5.145e+00   3.061 0.002208 ** 
b151        -2.419e+01  4.177e+00  -5.791 7.02e-09 ***
b152         1.575e+01  5.136e+00   3.065 0.002175 ** 
b153        -2.490e+01  4.173e+00  -5.968 2.42e-09 ***
b154         1.635e+01  5.137e+00   3.183 0.001457 ** 
b155        -2.573e+01  4.177e+00  -6.159 7.37e-10 ***
b156         1.289e+01  5.145e+00   2.505 0.012249 *  
b157        -2.548e+01  4.179e+00  -6.097 1.09e-09 ***
b158         1.578e+01  5.145e+00   3.067 0.002163 ** 
b159        -2.129e+01  4.177e+00  -5.096 3.47e-07 ***
b160         1.542e+01  5.136e+00   3.003 0.002677 ** 
b161        -2.664e+01  4.173e+00  -6.385 1.73e-10 ***
b162         1.642e+01  5.137e+00   3.196 0.001393 ** 
b163        -2.031e+01  4.177e+00  -4.861 1.17e-06 ***
b164         1.585e+01  5.145e+00   3.081 0.002061 ** 
b165        -2.289e+01  4.179e+00  -5.476 4.37e-08 ***
b166         1.639e+01  5.145e+00   3.185 0.001447 ** 
b167        -2.636e+01  4.177e+00  -6.311 2.80e-10 ***
b168         1.610e+01  5.136e+00   3.135 0.001719 ** 
b169        -2.453e+01  4.173e+00  -5.879 4.15e-09 ***
b170         1.343e+01  5.137e+00   2.614 0.008958 ** 
b171        -2.289e+01  4.177e+00  -5.480 4.26e-08 ***
b172         1.414e+01  5.145e+00   2.748 0.005993 ** 
b173        -2.596e+01  4.179e+00  -6.212 5.27e-10 ***
b174         1.384e+01  5.145e+00   2.690 0.007148 ** 
b175        -2.392e+01  4.177e+00  -5.726 1.03e-08 ***
b176         1.538e+01  5.136e+00   2.994 0.002755 ** 
b177        -2.393e+01  4.173e+00  -5.735 9.82e-09 ***
b178         1.477e+01  5.137e+00   2.876 0.004035 ** 
b179        -2.255e+01  4.177e+00  -5.398 6.76e-08 ***
b180         1.355e+01  5.145e+00   2.634 0.008434 ** 
b181        -2.302e+01  4.179e+00  -5.507 3.66e-08 ***
b182         1.565e+01  5.145e+00   3.043 0.002346 ** 
b183        -2.349e+01  4.177e+00  -5.624 1.87e-08 ***
b184         1.819e+01  5.136e+00   3.541 0.000400 ***
b185        -2.231e+01  4.173e+00  -5.347 9.00e-08 ***
b186         1.415e+01  5.137e+00   2.755 0.005866 ** 
b187        -2.057e+01  4.177e+00  -4.926 8.44e-07 ***
b188         1.396e+01  5.145e+00   2.713 0.006676 ** 
b189        -2.573e+01  4.179e+00  -6.156 7.50e-10 ***
b190         1.609e+01  5.145e+00   3.127 0.001766 ** 
b191        -2.432e+01  4.177e+00  -5.824 5.79e-09 ***
b192         1.522e+01  5.136e+00   2.964 0.003040 ** 
b193        -2.487e+01  4.173e+00  -5.961 2.52e-09 ***
b194         1.596e+01  5.137e+00   3.106 0.001895 ** 
b195        -2.250e+01  4.177e+00  -5.386 7.24e-08 ***
b196         1.456e+01  5.145e+00   2.831 0.004645 ** 
b197        -2.272e+01  4.179e+00  -5.436 5.47e-08 ***
b198         1.654e+01  5.145e+00   3.216 0.001302 ** 
b199        -2.441e+01  4.177e+00  -5.844 5.13e-09 ***
b200         1.660e+01  5.136e+00   3.231 0.001235 ** 
b201        -2.583e+01  4.173e+00  -6.189 6.09e-10 ***
b202         1.519e+01  5.136e+00   2.957 0.003105 ** 
b203        -2.315e+01  4.177e+00  -5.542 3.01e-08 ***
b204         1.650e+01  5.145e+00   3.208 0.001338 ** 
b205        -2.203e+01  4.179e+00  -5.271 1.36e-07 ***
b206         1.496e+01  5.145e+00   2.908 0.003637 ** 
b207        -2.437e+01  4.177e+00  -5.834 5.43e-09 ***
b208         1.531e+01  5.136e+00   2.980 0.002881 ** 
b209        -2.317e+01  4.173e+00  -5.552 2.84e-08 ***
b210         1.553e+01  5.136e+00   3.023 0.002500 ** 
b211        -2.328e+01  4.177e+00  -5.573 2.51e-08 ***
b212         1.478e+01  5.145e+00   2.873 0.004063 ** 
b213        -2.276e+01  4.179e+00  -5.445 5.20e-08 ***
b214         1.641e+01  5.145e+00   3.189 0.001430 ** 
b215        -2.462e+01  4.177e+00  -5.894 3.78e-09 ***
b216         1.731e+01  5.136e+00   3.371 0.000750 ***
b217        -2.540e+01  4.173e+00  -6.087 1.16e-09 ***
b218         1.774e+01  5.136e+00   3.453 0.000554 ***
b219        -2.189e+01  4.177e+00  -5.241 1.60e-07 ***
b220         1.741e+01  5.145e+00   3.384 0.000714 ***
b221        -2.412e+01  4.179e+00  -5.770 7.96e-09 ***
b222         1.498e+01  5.145e+00   2.912 0.003587 ** 
b223        -2.125e+01  4.177e+00  -5.088 3.62e-07 ***
b224         1.454e+01  5.136e+00   2.830 0.004651 ** 
b225        -2.173e+01  4.173e+00  -5.208 1.92e-07 ***
b226         1.593e+01  5.136e+00   3.101 0.001933 ** 
b227        -2.106e+01  4.177e+00  -5.041 4.65e-07 ***
b228         1.641e+01  5.145e+00   3.189 0.001429 ** 
b229        -2.184e+01  4.179e+00  -5.225 1.75e-07 ***
b230         1.478e+01  5.145e+00   2.873 0.004069 ** 
b231        -2.098e+01  4.177e+00  -5.024 5.07e-07 ***
b232         1.711e+01  5.136e+00   3.332 0.000863 ***
b233        -2.486e+01  4.173e+00  -5.958 2.56e-09 ***
b234         1.538e+01  5.136e+00   2.994 0.002756 ** 
b235        -2.188e+01  4.177e+00  -5.239 1.62e-07 ***
b236         1.547e+01  5.145e+00   3.006 0.002644 ** 
b237        -2.200e+01  4.179e+00  -5.264 1.42e-07 ***
b238         1.450e+01  5.145e+00   2.818 0.004830 ** 
b239        -2.379e+01  4.177e+00  -5.697 1.23e-08 ***
b240         1.834e+01  5.136e+00   3.570 0.000357 ***
b241        -2.501e+01  4.173e+00  -5.994 2.06e-09 ***
b242         1.725e+01  5.136e+00   3.358 0.000787 ***
b243        -2.456e+01  4.177e+00  -5.881 4.10e-09 ***
b244         1.733e+01  5.145e+00   3.368 0.000757 ***
b245        -2.311e+01  4.179e+00  -5.529 3.23e-08 ***
b246         1.583e+01  5.145e+00   3.077 0.002093 ** 
b247        -2.448e+01  4.177e+00  -5.861 4.63e-09 ***
b248         1.667e+01  5.136e+00   3.246 0.001171 ** 
b249        -2.258e+01  4.173e+00  -5.411 6.30e-08 ***
b250         1.552e+01  5.136e+00   3.022 0.002515 ** 
b251        -2.358e+01  4.177e+00  -5.645 1.66e-08 ***
b252         1.513e+01  5.145e+00   2.941 0.003270 ** 
b253        -2.271e+01  4.179e+00  -5.434 5.55e-08 ***
b254         1.580e+01  5.145e+00   3.071 0.002136 ** 
b255        -2.330e+01  4.177e+00  -5.578 2.44e-08 ***
b256         1.461e+01  5.136e+00   2.844 0.004457 ** 
b257        -2.324e+01  4.173e+00  -5.569 2.58e-08 ***
b258         1.607e+01  5.136e+00   3.130 0.001752 ** 
b259        -2.310e+01  4.177e+00  -5.530 3.22e-08 ***
b260         1.627e+01  5.145e+00   3.163 0.001562 ** 
b261        -2.466e+01  4.179e+00  -5.900 3.66e-09 ***
b262         1.820e+01  5.145e+00   3.537 0.000404 ***
b263        -2.549e+01  4.177e+00  -6.102 1.05e-09 ***
b264         1.864e+01  5.136e+00   3.628 0.000286 ***
b265        -2.446e+01  4.173e+00  -5.862 4.61e-09 ***
b266         1.572e+01  5.136e+00   3.061 0.002210 ** 
b267        -2.200e+01  4.177e+00  -5.267 1.39e-07 ***
b268         1.726e+01  5.145e+00   3.354 0.000797 ***
b269        -2.338e+01  4.179e+00  -5.594 2.23e-08 ***
b270         1.559e+01  5.145e+00   3.029 0.002451 ** 
b271        -2.127e+01  4.177e+00  -5.094 3.52e-07 ***
b272         1.554e+01  5.136e+00   3.025 0.002483 ** 
b273        -2.043e+01  4.173e+00  -4.897 9.74e-07 ***
b274         1.244e+01  5.136e+00   2.423 0.015405 *  
b275        -2.200e+01  4.177e+00  -5.266 1.40e-07 ***
b276         1.622e+01  5.145e+00   3.152 0.001621 ** 
b277        -2.509e+01  4.179e+00  -6.004 1.94e-09 ***
b278         1.627e+01  5.145e+00   3.162 0.001569 ** 
b279        -2.421e+01  4.177e+00  -5.797 6.79e-09 ***
b280         1.538e+01  5.136e+00   2.994 0.002755 ** 
b281        -2.213e+01  4.172e+00  -5.304 1.14e-07 ***
b282         1.387e+01  5.136e+00   2.700 0.006931 ** 
b283        -2.206e+01  4.177e+00  -5.281 1.29e-07 ***
b284         1.494e+01  5.145e+00   2.905 0.003680 ** 
b285        -2.430e+01  4.179e+00  -5.814 6.12e-09 ***
b286         1.611e+01  5.145e+00   3.132 0.001739 ** 
b287        -2.120e+01  4.177e+00  -5.075 3.88e-07 ***
b288         1.570e+01  5.136e+00   3.056 0.002242 ** 
b289        -2.392e+01  4.172e+00  -5.732 9.97e-09 ***
b290         1.616e+01  5.136e+00   3.146 0.001655 ** 
b291        -2.189e+01  4.177e+00  -5.241 1.60e-07 ***
b292         1.470e+01  5.145e+00   2.858 0.004268 ** 
b293        -2.115e+01  4.179e+00  -5.062 4.16e-07 ***
b294         1.377e+01  5.145e+00   2.676 0.007442 ** 
b295        -1.902e+01  4.177e+00  -4.554 5.27e-06 ***
b296         1.489e+01  5.136e+00   2.898 0.003756 ** 
b297        -2.143e+01  4.172e+00  -5.136 2.81e-07 ***
b298         1.600e+01  5.136e+00   3.115 0.001842 ** 
b299        -2.214e+01  4.177e+00  -5.301 1.16e-07 ***
b300         1.484e+01  5.145e+00   2.885 0.003915 ** 
b301        -2.133e+01  4.179e+00  -5.105 3.32e-07 ***
b302         1.518e+01  5.145e+00   2.951 0.003172 ** 
b303        -1.956e+01  4.177e+00  -4.683 2.83e-06 ***
b304         1.618e+01  5.136e+00   3.150 0.001634 ** 
b305        -2.251e+01  4.172e+00  -5.395 6.87e-08 ***
b306         1.370e+01  5.136e+00   2.668 0.007628 ** 
b307        -2.177e+01  4.177e+00  -5.212 1.87e-07 ***
b308         1.500e+01  5.145e+00   2.916 0.003547 ** 
b309        -2.458e+01  4.179e+00  -5.881 4.10e-09 ***
b310         1.747e+01  5.145e+00   3.396 0.000685 ***
b311        -2.164e+01  4.177e+00  -5.180 2.22e-07 ***
b312         1.590e+01  5.136e+00   3.096 0.001963 ** 
b313        -2.463e+01  4.172e+00  -5.903 3.60e-09 ***
b314         1.655e+01  5.136e+00   3.222 0.001272 ** 
b315        -2.269e+01  4.177e+00  -5.433 5.57e-08 ***
b316         1.476e+01  5.145e+00   2.870 0.004109 ** 
b317        -1.833e+01  4.179e+00  -4.385 1.16e-05 ***
b318         1.616e+01  5.145e+00   3.142 0.001679 ** 
b319        -1.985e+01  4.177e+00  -4.752 2.01e-06 ***
b320         1.649e+01  5.136e+00   3.210 0.001329 ** 
b321        -2.020e+01  4.172e+00  -4.842 1.29e-06 ***
b322         1.458e+01  5.136e+00   2.840 0.004515 ** 
b323        -2.174e+01  4.175e+00  -5.206 1.94e-07 ***
b324         1.802e+01  5.141e+00   3.505 0.000457 ***
b325        -2.053e+01  4.173e+00  -4.919 8.73e-07 ***
b326         1.696e+01  5.130e+00   3.306 0.000947 ***
b327        -2.467e+01  4.164e+00  -5.925 3.14e-09 ***
b328         1.793e+01  5.327e+00   3.366 0.000764 ***
b329         6.301e+02  2.464e+03   0.256 0.798213    
---
Signif. codes:  0 ‘***’ 0.001 ‘**’ 0.01 ‘*’ 0.05 ‘.’ 0.1 ‘ ’ 1

Residual standard error: 4.141 on 59273 degrees of freedom
  (7401 observations deleted due to missingness)
Multiple R-squared:  0.8413,	Adjusted R-squared:  0.8403 
F-statistic: 833.4 on 377 and 59273 DF,  p-value: < 2.2e-16

> 
> # register the results
> data <- data %>% mutate(mu = NA , ctemp = NA)
> for(k in 1:p){
+   data[non_na & row_ids[,k],] <- data[non_na & row_ids[,k],] %>% 
+     mutate(mu = lms[[k]]$fitted.values, ctemp = mean_temp - mu)
+ }
> 
> # remove b cols of data (for memory)
> data <- data %>% 
+   select(!any_of(b_cols[[which.max(sapply(b_cols, length))]])) %>%
+   select(!any_of(c(s_cols, c_cols)))
> gc()
            used   (Mb) gc trigger   (Mb)  max used   (Mb)
Ncells   2495274  133.3    4520294  241.5   4520294  241.5
Vcells 203343232 1551.4  600574773 4582.1 511963922 3906.0
> 
> # quick check
> data0 <- data %>% group_by(year, station_name) %>%
+   summarise(m_mt = mean(mean_temp, na.rm=T),
+             m_mu = mean(mu, na.rm=T))
`summarise()` has grouped output by 'year'. You can override using the
`.groups` argument.
> ggplot(data0, aes(x=year, y=m_mt, col=station_name, group=station_name)) +
+   theme_light() +
+   geom_line(data = data0, aes(y=m_mu), col=1) +
+   geom_point()
Warning messages:
1: Removed 20 row(s) containing missing values (geom_path). 
2: Removed 25 rows containing missing values (geom_point). 
> 
> data0 <- data %>% filter(year %in% 1950:1970) %>%
+   group_by(year, month, station_name) %>%
+   summarise(m_mt = mean(mean_temp, na.rm=T),
+             m_mu = mean(mu, na.rm=T))
`summarise()` has grouped output by 'year', 'month'. You can override using the
`.groups` argument.
> ggplot(data0, aes(x=year+month/12, y=m_mt, col=station_name, group=station_name)) +
+   geom_line() + geom_point() +
+   geom_line(data = data0, aes(y=m_mu)) +
+   facet_wrap(~station_name)
Warning messages:
1: Removed 21 row(s) containing missing values (geom_path). 
2: Removed 21 rows containing missing values (geom_point). 
3: Removed 21 row(s) containing missing values (geom_path). 
> 
> 
> # random check of the fits
> # some plots might show a break (when the data goes from Ottawa to Toronto)
> k <- sample(nrow(data),1)
> ii <- k + 1:365
> plot(data$time[ii], data$mean_temp[ii])
> lines(data$time[ii], data$mu[ii], col=2)
> 
> 
> # note that this breaks the equalities in the data
> # but there is still some heterogeneity in the variance
> N <- 20000 
> par(mfrow=c(p,2), mar=c(1,1,0,0))
> for(k in 1:p){
+   plot(data$yday[row_ids[,k]][1:N], data$mean_temp[row_ids[,k]][1:N], cex=.25)
+   plot(data$yday[row_ids[,k]][1:N], data$ctemp[row_ids[,k]][1:N], cex=.25)
+ }
> 
> 
> 
> # Compute pseudo-observations using ECDF ----------------------------------
> data <- data %>% mutate(pseudo_temp = NA, diff = NA, w1 = NA, w = NA)
> for(k in 1:p){
+   id <- stns_id[k]
+   cat("Working on ECDF for station ", id, ".\n")
+   row_id <- row_ids[,k]
+   
+   for(tt in 1:366){
+     if(tt %% 20 == 0) cat("progess: ", round(tt/366*100,2), "%\n")
+     
+     # construct weights based on yday using gaussian kernel
+     data[row_id,] <- data[row_id,] %>%
+       mutate(diff = tt - (time %% year_len)) %>%
+       mutate(diff = abs(pmin(diff, year_len - diff))) %>%
+       mutate(w1 = dnorm(diff,0,1)) %>%
+       mutate(w = w1/sum(w1, na.rm = T)) 
+     
+     # construct ecdf function using all the data
+     wecdf <- spatstat.geom::ewcdf(data[row_id,]$ctemp, data[row_id,]$w)
+     
+     # compute ecdf only for yday we care for
+     ind <- which(data[row_id,]$yday == tt & !is.na(data[row_id,]$ctemp))
+     data[row_id,][ind,] <- data[row_id,][ind,] %>%
+       mutate(pseudo_temp = wecdf(ctemp))
+     
+     # heuristic correction for the largest (pseudo_obs = 1)
+     # to avoid modifying all values (say, with pseudo_obs = pseudo_obs*n_ind/(n_ind+1))
+     n_ind <- length(ind)
+     data[row_id,][ind,] <- data[row_id,][ind,] %>%
+       mutate(pseudo_temp = ifelse(pseudo_temp == 1, 1-1/(2*n_ind), pseudo_temp))
+   }
+ }
Working on ECDF for station  568 .
progess:  5.46 %
progess:  10.93 %
progess:  16.39 %
progess:  21.86 %
progess:  27.32 %
progess:  32.79 %
progess:  38.25 %
progess:  43.72 %
progess:  49.18 %
progess:  54.64 %
progess:  60.11 %
progess:  65.57 %
progess:  71.04 %
progess:  76.5 %
progess:  81.97 %
progess:  87.43 %
progess:  92.9 %
progess:  98.36 %
Working on ECDF for station  4333 .
progess:  5.46 %
progess:  10.93 %
progess:  16.39 %
progess:  21.86 %
progess:  27.32 %
progess:  32.79 %
progess:  38.25 %
progess:  43.72 %
progess:  49.18 %
progess:  54.64 %
progess:  60.11 %
progess:  65.57 %
progess:  71.04 %
progess:  76.5 %
progess:  81.97 %
progess:  87.43 %
progess:  92.9 %
progess:  98.36 %
Working on ECDF for station  5051 .
progess:  5.46 %
progess:  10.93 %
progess:  16.39 %
progess:  21.86 %
progess:  27.32 %
progess:  32.79 %
progess:  38.25 %
progess:  43.72 %
progess:  49.18 %
progess:  54.64 %
progess:  60.11 %
progess:  65.57 %
progess:  71.04 %
progess:  76.5 %
progess:  81.97 %
progess:  87.43 %
progess:  92.9 %
progess:  98.36 %
> 
> 
> 
> # resulting histograms are even better than expected
> ggplot(data, aes(x = pseudo_temp, fill=as.factor(yday))) +
+   theme(legend.position = "none") +
+   geom_histogram(breaks=seq(0,1,.05), position = position_stack()) +
+   facet_wrap(~station_name)
Warning message:
Removed 12480 rows containing non-finite values (stat_bin). 
> 
> # quick check of the other operations (tt = 366, last it. of for loop)
> s <- sample(nrow(data) - 1000,1)
> par(mfrow=c(3,1))
> plot(data$pseudo_temp[s + 1:100], type="o") # makes sense
> plot(data$date[s + 1:1000], data$diff[s + 1:1000]) # linear in time, as expected
> plot(data$date[s + 1:1000], data$w[s + 1:1000], type="l") # select only end of year periods
> 
> # note that there are equalities, but very very few of them. can disregard.
> apply(row_ids, 2, \(r){
+   tab <- table(data[r,]$pseudo_temp)
+   tab[tab > 1]
+ })
      [,1] [,2] [,3]
 [1,]    2    2    2
 [2,]    2    2    2
 [3,]    2    2    3
 [4,]    2    2    2
 [5,]    2    2    2
 [6,]    3    2    2
 [7,]    6    4   15
 [8,]    4   10    7
 [9,]    5    8    2
[10,]    3    4    3
> 
> 
> 
> # Save for later use ------------------------------------------------------
> saveRDS(data, "app/data/data_pp5.rds")
> 
> proc.time()
    user   system  elapsed 
1575.541   11.839 1587.478 
