
R version 4.2.1 (2022-06-23) -- "Funny-Looking Kid"
Copyright (C) 2022 The R Foundation for Statistical Computing
Platform: x86_64-pc-linux-gnu (64-bit)

R is free software and comes with ABSOLUTELY NO WARRANTY.
You are welcome to redistribute it under certain conditions.
Type 'license()' or 'licence()' for distribution details.

  Natural language support but running in an English locale

R is a collaborative project with many contributors.
Type 'contributors()' for more information and
'citation()' on how to cite R or R packages in publications.

Type 'demo()' for some demos, 'help()' for on-line help, or
'help.start()' for an HTML browser interface to help.
Type 'q()' to quit R.

> # Preprocessing of the raw data
> # launched with 
> # R CMD BATCH --vanilla --no-restore app/preprocessing.R app/log_pp.txt
> 
> # packages ----------------------------------------------------------------
> library(tidyverse)
── Attaching packages ─────────────────────────────────────── tidyverse 1.3.2 ──
✔ ggplot2 3.3.6     ✔ purrr   0.3.4
✔ tibble  3.1.8     ✔ dplyr   1.1.0
✔ tidyr   1.2.1     ✔ stringr 1.4.1
✔ readr   2.1.2     ✔ forcats 0.5.2
── Conflicts ────────────────────────────────────────── tidyverse_conflicts() ──
✖ dplyr::filter() masks stats::filter()
✖ dplyr::lag()    masks stats::lag()
> library(lubridate)

Attaching package: ‘lubridate’

The following objects are masked from ‘package:base’:

    date, intersect, setdiff, union

> library(lunar)
> library(ggplot2)
> library(spatstat.geom) # weighted ecdf
Loading required package: spatstat.data
spatstat.geom 3.2-4
> 
> 
> 
> # load and preprocess data ------------------------------------------------
> stns_id <- readRDS("app/data/stns_id.rds")
> weathercan::stations() %>% filter(station_id %in% stns_id, interval == "day") %>%
+   print(nrow = nrow(.))
The stations data frame hasn't been updated in over 4 weeks. Consider running `stations_dl()` to check for updates and make sure you have the most recent stations list available
# A tibble: 8 × 16
  prov  station…¹ stati…² clima…³ WMO_id TC_id   lat    lon   elev tz    inter…⁴
  <chr> <chr>       <dbl> <chr>    <dbl> <chr> <dbl>  <dbl>  <dbl> <chr> <chr>  
1 BC    QUATSINO      271 1036570     NA <NA>   50.5 -128.  3.42e0 Etc/… day    
2 BC    BARKERVI…     568 1090660     NA <NA>   53.1 -122.  1.28e3 Etc/… day    
3 BC    AGASSIZ …     707 1100120     NA <NA>   49.2 -122.  1.5 e1 Etc/… day    
4 ON    OTTAWA C…    4333 6105976     NA WCG    45.4  -75.7 7.92e1 Etc/… day    
5 ON    WELLAND      4712 6139445     NA <NA>   43.0  -79.3 1.75e2 Etc/… day    
6 ON    BELLEVIL…    4859 6150689     NA <NA>   44.2  -77.4 7.62e1 Etc/… day    
7 ON    BLOOMFIE…    4862 6150815     NA <NA>   44.0  -77.2 9.14e1 Etc/… day    
8 ON    TORONTO      5051 6158350  71266 <NA>   43.7  -79.4 1.12e2 Etc/… day    
# … with 5 more variables: start <dbl>, end <dbl>, normals <lgl>,
#   normals_1981_2010 <lgl>, normals_1971_2000 <lgl>, and abbreviated variable
#   names ¹​station_name, ²​station_id, ³​climate_id, ⁴​interval
> 
> filepaths <- paste0("app/data/daily_data_", stns_id, ".rds")
> data <- lapply(filepaths, readRDS) |> dplyr::bind_rows()
> str(data)
tibble [421,408 × 37] (S3: tbl_df/tbl/data.frame)
 $ station_name      : chr [1:421408] "QUATSINO" "QUATSINO" "QUATSINO" "QUATSINO" ...
 $ station_id        : num [1:421408] 271 271 271 271 271 271 271 271 271 271 ...
 $ station_operator  : logi [1:421408] NA NA NA NA NA NA ...
 $ prov              : chr [1:421408] "BC" "BC" "BC" "BC" ...
 $ lat               : num [1:421408] 50.5 50.5 50.5 50.5 50.5 ...
 $ lon               : num [1:421408] -128 -128 -128 -128 -128 ...
 $ elev              : num [1:421408] 3.4 3.4 3.4 3.4 3.4 3.4 3.4 3.4 3.4 3.4 ...
 $ climate_id        : chr [1:421408] "1036570" "1036570" "1036570" "1036570" ...
 $ WMO_id            : chr [1:421408] NA NA NA NA ...
 $ TC_id             : chr [1:421408] NA NA NA NA ...
 $ date              : Date[1:421408], format: "1895-01-01" "1895-01-02" ...
 $ year              : chr [1:421408] "1895" "1895" "1895" "1895" ...
 $ month             : chr [1:421408] "01" "01" "01" "01" ...
 $ day               : chr [1:421408] "01" "02" "03" "04" ...
 $ qual              : chr [1:421408] NA NA NA NA ...
 $ cool_deg_days     : num [1:421408] NA NA NA NA NA NA NA NA NA NA ...
 $ cool_deg_days_flag: chr [1:421408] NA NA NA NA ...
 $ dir_max_gust      : num [1:421408] NA NA NA NA NA NA NA NA NA NA ...
 $ dir_max_gust_flag : chr [1:421408] NA NA NA NA ...
 $ heat_deg_days     : num [1:421408] NA NA NA NA NA NA NA NA NA NA ...
 $ heat_deg_days_flag: chr [1:421408] NA NA NA NA ...
 $ max_temp          : num [1:421408] NA NA NA NA NA NA NA NA NA NA ...
 $ max_temp_flag     : chr [1:421408] NA NA NA NA ...
 $ mean_temp         : num [1:421408] NA NA NA NA NA NA NA NA NA NA ...
 $ mean_temp_flag    : chr [1:421408] NA NA NA NA ...
 $ min_temp          : num [1:421408] NA NA NA NA NA NA NA NA NA NA ...
 $ min_temp_flag     : chr [1:421408] NA NA NA NA ...
 $ snow_grnd         : num [1:421408] NA NA NA NA NA NA NA NA NA NA ...
 $ snow_grnd_flag    : chr [1:421408] NA NA NA NA ...
 $ spd_max_gust      : num [1:421408] NA NA NA NA NA NA NA NA NA NA ...
 $ spd_max_gust_flag : chr [1:421408] NA NA NA NA ...
 $ total_precip      : num [1:421408] NA NA NA NA NA NA NA NA NA NA ...
 $ total_precip_flag : chr [1:421408] NA NA NA NA ...
 $ total_rain        : num [1:421408] NA NA NA NA NA NA NA NA NA NA ...
 $ total_rain_flag   : chr [1:421408] NA NA NA NA ...
 $ total_snow        : num [1:421408] NA NA NA NA NA NA NA NA NA NA ...
 $ total_snow_flag   : chr [1:421408] NA NA NA NA ...
> 
> # time variables setup
> data <- data %>% mutate(date = as.Date(date),
+                         year = as.integer(year),
+                         month = as.integer(month),
+                         day = as.integer(day))
> 
> data <- data %>% mutate(time = as.integer(date),
+                         yday = lubridate::yday(date),
+                         week = lubridate::week(date))
> 
> # stations we look at
> stns_id <- c(568, 4333, 5051)
> p <- 3
> data <- data %>%
+   filter(station_id %in% stns_id) %>%
+   arrange(station_id, date)
> 
> # quick look at summary of the data (clearly shows time trends)
> data0 <- data %>% group_by(station_name, year) %>%
+   summarise(mm_temp = mean(mean_temp, na.rm=T))
`summarise()` has grouped output by 'station_name'. You can override using the
`.groups` argument.
> ggplot(data0, aes(x=year, y=mm_temp)) +
+   geom_line() +
+   geom_point() +
+   facet_wrap(~station_name)
Warning messages:
1: Removed 20 row(s) containing missing values (geom_path). 
2: Removed 25 rows containing missing values (geom_point). 
> 
> 
> # Estimate mean conditional on time of year -------------------------------
> year_len <- 365 + 6/24 + 9/60/24 + 9/60^2/24
> 
> # create sines-cosines basis (for seasonal trend)
> nSC <- 12
> s_cols <- paste0("s", 1:nSC)
> c_cols <- paste0("c", 1:nSC)
> for (i in 1:nSC) data <- data %>%
+   mutate(!!s_cols[i] := sin(i*2*pi*time/year_len),
+          !!c_cols[i] := cos(i*2*pi*time/year_len))
> 
> 
> # create natural spline basis (for long term time trend)
> # for this check range for each station
> row_ids <- sapply(stns_id, \(id) data$station_id == id)
> bss <- lapply(1:p, \(k){
+   data[row_ids[,k],] %>% filter(day == 21, month %in% c(6,12)) %>% select(time) %>% unlist
+ })
> 
> for(b in paste("b", 1:max(sapply(bss, length)))) data <- data %>% mutate(!!b := NA)
> nB <- rep(0, p); b_cols <- list()
> for(k in 1:p){
+   B <- splines::bs(data[row_ids[,k],]$time, knots = c(bss[[k]]))
+   B <- B[,colSums(abs(B[!is.na(data[row_ids[,k],]$mean_temp),])) > 1e-5]
+   nB[k] <- ncol(B)
+   b_cols[[length(b_cols)+1]] <- paste0("b", 1:nB[k])
+   data[row_ids[,k],b_cols[[k]]] <- B
+   rm(B)
+ }
> 
> 
> # fit least-squares
> non_na <- !is.na(data$mean_temp) # for later
> lms <- lapply(1:p, \(k){
+   x_cols <- c("mean_temp", s_cols, c_cols, b_cols[[k]])
+   lm(formula = "mean_temp~.", data = data[row_ids[,k],x_cols])
+ })
> 
> # Bakerville
> summary(lms[[1]])

Call:
lm(formula = "mean_temp~.", data = data[row_ids[, k], x_cols])

Residuals:
    Min      1Q  Median      3Q     Max 
-31.905  -2.443   0.254   2.978  17.137 

Coefficients:
              Estimate Std. Error t value Pr(>|t|)    
(Intercept) -3.474e+00  5.299e+00  -0.656 0.512117    
s1          -5.942e+00  7.715e-01  -7.702 1.37e-14 ***
s2           5.807e-01  3.181e-02  18.254  < 2e-16 ***
s3          -2.792e-02  4.167e-02  -0.670 0.502828    
s4           2.325e-01  3.148e-02   7.387 1.53e-13 ***
s5          -2.046e-01  3.193e-02  -6.406 1.51e-10 ***
s6          -9.564e-02  3.146e-02  -3.041 0.002363 ** 
s7          -7.817e-02  3.149e-02  -2.482 0.013056 *  
s8           3.886e-03  3.145e-02   0.124 0.901667    
s9          -3.852e-02  3.145e-02  -1.225 0.220575    
s10          6.719e-02  3.142e-02   2.138 0.032492 *  
s11          6.554e-02  3.141e-02   2.086 0.036952 *  
s12          4.505e-03  3.141e-02   0.143 0.885937    
c1           4.730e+00  3.989e+00   1.186 0.235743    
c2          -3.215e-01  3.157e-02 -10.182  < 2e-16 ***
c3           1.288e-01  5.254e-02   2.452 0.014221 *  
c4          -1.169e-01  3.152e-02  -3.709 0.000208 ***
c5           1.641e-01  3.166e-02   5.185 2.17e-07 ***
c6          -1.261e-01  3.145e-02  -4.009 6.10e-05 ***
c7          -6.263e-02  3.145e-02  -1.992 0.046407 *  
c8          -8.854e-02  3.142e-02  -2.818 0.004837 ** 
c9          -1.227e-03  3.142e-02  -0.039 0.968838    
c10          3.003e-02  3.143e-02   0.955 0.339335    
c11         -7.390e-03  3.143e-02  -0.235 0.814112    
c12         -1.070e-01  3.143e-02  -3.406 0.000660 ***
b1          -7.766e+00  4.693e+00  -1.655 0.097990 .  
b2           5.217e+01  1.612e+01   3.236 0.001213 ** 
b3          -3.920e+01  8.540e+00  -4.590 4.45e-06 ***
b4           5.302e+01  1.693e+01   3.131 0.001740 ** 
b5          -4.051e+01  8.618e+00  -4.701 2.60e-06 ***
b6           5.072e+01  1.701e+01   2.982 0.002864 ** 
b7          -3.868e+01  8.591e+00  -4.503 6.71e-06 ***
b8           5.007e+01  1.701e+01   2.944 0.003241 ** 
b9          -3.882e+01  8.591e+00  -4.519 6.23e-06 ***
b10          5.123e+01  1.698e+01   3.017 0.002551 ** 
b11         -4.070e+01  8.554e+00  -4.759 1.96e-06 ***
b12          5.162e+01  1.701e+01   3.034 0.002414 ** 
b13         -4.229e+01  8.596e+00  -4.919 8.72e-07 ***
b14          5.339e+01  1.703e+01   3.135 0.001717 ** 
b15         -4.102e+01  8.587e+00  -4.777 1.78e-06 ***
b16          5.279e+01  1.700e+01   3.104 0.001908 ** 
b17         -4.156e+01  8.576e+00  -4.847 1.26e-06 ***
b18          5.306e+01  1.701e+01   3.119 0.001813 ** 
b19         -4.310e+01  8.572e+00  -5.028 4.98e-07 ***
b20          5.507e+01  1.703e+01   3.234 0.001221 ** 
b21         -4.213e+01  8.606e+00  -4.895 9.85e-07 ***
b22          5.565e+01  1.705e+01   3.263 0.001103 ** 
b23         -4.219e+01  8.614e+00  -4.898 9.72e-07 ***
b24          4.838e+01  1.705e+01   2.838 0.004548 ** 
b25         -3.529e+01  8.614e+00  -4.097 4.20e-05 ***
b26          5.071e+01  1.705e+01   2.974 0.002943 ** 
b27         -3.942e+01  8.614e+00  -4.576 4.75e-06 ***
b28          4.966e+01  1.705e+01   2.912 0.003587 ** 
b29         -3.575e+01  8.610e+00  -4.153 3.29e-05 ***
b30          4.877e+01  1.704e+01   2.862 0.004213 ** 
b31         -3.942e+01  8.594e+00  -4.587 4.52e-06 ***
b32          4.982e+01  1.701e+01   2.929 0.003401 ** 
b33         -4.010e+01  8.578e+00  -4.674 2.96e-06 ***
b34          4.942e+01  1.701e+01   2.905 0.003678 ** 
b35         -3.606e+01  8.573e+00  -4.206 2.60e-05 ***
b36          5.034e+01  1.703e+01   2.956 0.003115 ** 
b37         -4.019e+01  8.600e+00  -4.674 2.96e-06 ***
b38          5.529e+01  1.704e+01   3.246 0.001173 ** 
b39         -4.598e+01  8.601e+00  -5.346 9.03e-08 ***
b40          5.245e+01  1.701e+01   3.084 0.002045 ** 
b41         -3.975e+01  8.578e+00  -4.634 3.60e-06 ***
b42          5.093e+01  1.701e+01   2.994 0.002759 ** 
b43         -4.021e+01  8.572e+00  -4.691 2.73e-06 ***
b44          4.905e+01  1.703e+01   2.881 0.003970 ** 
b45         -4.229e+01  8.598e+00  -4.918 8.76e-07 ***
b46          5.185e+01  1.703e+01   3.044 0.002335 ** 
b47         -4.311e+01  8.591e+00  -5.018 5.24e-07 ***
b48          5.064e+01  1.701e+01   2.977 0.002908 ** 
b49         -4.221e+01  8.577e+00  -4.921 8.62e-07 ***
b50          5.333e+01  1.701e+01   3.135 0.001720 ** 
b51         -4.333e+01  8.572e+00  -5.055 4.33e-07 ***
b52          5.017e+01  1.703e+01   2.947 0.003214 ** 
b53         -3.934e+01  8.598e+00  -4.576 4.76e-06 ***
b54          5.088e+01  1.703e+01   2.987 0.002816 ** 
b55         -4.085e+01  8.591e+00  -4.755 1.99e-06 ***
b56          5.644e+01  1.701e+01   3.319 0.000905 ***
b57         -4.790e+01  8.577e+00  -5.584 2.37e-08 ***
b58          5.400e+01  1.701e+01   3.174 0.001503 ** 
b59         -4.481e+01  8.572e+00  -5.227 1.73e-07 ***
b60          5.040e+01  1.703e+01   2.960 0.003074 ** 
b61         -3.959e+01  8.598e+00  -4.605 4.14e-06 ***
b62          4.999e+01  1.703e+01   2.935 0.003342 ** 
b63         -3.820e+01  8.591e+00  -4.447 8.73e-06 ***
b64          4.826e+01  1.701e+01   2.838 0.004543 ** 
b65         -4.101e+01  8.577e+00  -4.781 1.75e-06 ***
b66          4.926e+01  1.701e+01   2.895 0.003788 ** 
b67         -3.964e+01  8.572e+00  -4.625 3.76e-06 ***
b68          5.145e+01  1.703e+01   3.022 0.002515 ** 
b69         -4.467e+01  8.598e+00  -5.195 2.05e-07 ***
b70          5.237e+01  1.703e+01   3.074 0.002111 ** 
b71         -4.155e+01  8.591e+00  -4.837 1.32e-06 ***
b72          5.144e+01  1.701e+01   3.024 0.002492 ** 
b73         -3.763e+01  8.577e+00  -4.387 1.15e-05 ***
b74          4.964e+01  1.701e+01   2.918 0.003524 ** 
b75         -3.964e+01  8.572e+00  -4.624 3.77e-06 ***
b76          4.942e+01  1.703e+01   2.903 0.003703 ** 
b77         -3.629e+01  8.598e+00  -4.221 2.44e-05 ***
b78          5.197e+01  1.703e+01   3.051 0.002282 ** 
b79         -4.232e+01  8.591e+00  -4.927 8.39e-07 ***
b80          5.254e+01  1.701e+01   3.089 0.002007 ** 
b81         -4.393e+01  8.577e+00  -5.122 3.04e-07 ***
b82          5.467e+01  1.701e+01   3.214 0.001311 ** 
b83         -4.313e+01  8.573e+00  -5.032 4.88e-07 ***
b84          5.179e+01  1.703e+01   3.042 0.002353 ** 
b85         -4.175e+01  8.598e+00  -4.855 1.21e-06 ***
b86          4.962e+01  1.703e+01   2.913 0.003582 ** 
b87         -3.608e+01  8.591e+00  -4.200 2.67e-05 ***
b88          5.036e+01  1.701e+01   2.961 0.003068 ** 
b89         -4.092e+01  8.577e+00  -4.771 1.84e-06 ***
b90          5.011e+01  1.701e+01   2.945 0.003228 ** 
b91         -3.793e+01  8.572e+00  -4.425 9.69e-06 ***
b92          4.830e+01  1.703e+01   2.837 0.004555 ** 
b93         -4.090e+01  8.598e+00  -4.757 1.97e-06 ***
b94          5.473e+01  1.703e+01   3.213 0.001315 ** 
b95         -4.703e+01  8.590e+00  -5.475 4.41e-08 ***
b96          5.417e+01  1.701e+01   3.185 0.001448 ** 
b97         -4.563e+01  8.577e+00  -5.320 1.04e-07 ***
b98          5.446e+01  1.701e+01   3.202 0.001368 ** 
b99         -4.660e+01  8.572e+00  -5.436 5.48e-08 ***
b100         5.440e+01  1.703e+01   3.195 0.001398 ** 
b101        -4.091e+01  8.598e+00  -4.759 1.95e-06 ***
b102         5.303e+01  1.703e+01   3.114 0.001850 ** 
b103        -4.036e+01  8.590e+00  -4.698 2.63e-06 ***
b104         4.963e+01  1.701e+01   2.918 0.003522 ** 
b105        -3.657e+01  8.577e+00  -4.263 2.02e-05 ***
b106         4.866e+01  1.701e+01   2.860 0.004233 ** 
b107        -3.795e+01  8.573e+00  -4.427 9.56e-06 ***
b108         5.317e+01  1.703e+01   3.123 0.001793 ** 
b109        -4.334e+01  8.598e+00  -5.041 4.65e-07 ***
b110         5.345e+01  1.703e+01   3.138 0.001704 ** 
b111        -4.407e+01  8.590e+00  -5.130 2.91e-07 ***
b112         4.938e+01  1.701e+01   2.904 0.003691 ** 
b113        -3.828e+01  8.577e+00  -4.462 8.12e-06 ***
b114         5.024e+01  1.701e+01   2.953 0.003146 ** 
b115        -3.796e+01  8.573e+00  -4.428 9.55e-06 ***
b116         4.785e+01  1.703e+01   2.810 0.004950 ** 
b117        -4.036e+01  8.598e+00  -4.694 2.69e-06 ***
b118         5.047e+01  1.703e+01   2.963 0.003047 ** 
b119        -4.228e+01  8.591e+00  -4.922 8.61e-07 ***
b120         5.368e+01  1.701e+01   3.156 0.001602 ** 
b121        -4.294e+01  8.586e+00  -5.001 5.71e-07 ***
b122         5.402e+01  1.703e+01   3.172 0.001515 ** 
b123        -4.290e+01  8.741e+00  -4.907 9.27e-07 ***
b124         3.253e+01  1.894e+01   1.718 0.085888 .  
b125         4.494e+02  1.572e+03   0.286 0.774972    
b126        -8.846e+02  3.176e+02  -2.786 0.005344 ** 
b127         5.999e+01  1.816e+01   3.302 0.000960 ***
b128        -4.608e+01  8.740e+00  -5.273 1.35e-07 ***
b129         5.271e+01  1.704e+01   3.093 0.001985 ** 
b130        -3.925e+01  8.588e+00  -4.570 4.90e-06 ***
b131         5.034e+01  1.703e+01   2.956 0.003121 ** 
b132        -3.912e+01  8.601e+00  -4.548 5.43e-06 ***
b133         4.670e+01  1.704e+01   2.741 0.006122 ** 
b134        -3.753e+01  8.591e+00  -4.368 1.26e-05 ***
b135         4.807e+01  1.701e+01   2.826 0.004711 ** 
b136        -4.525e+01  8.578e+00  -5.275 1.34e-07 ***
b137         5.289e+01  1.701e+01   3.109 0.001880 ** 
b138        -4.394e+01  8.573e+00  -5.125 2.99e-07 ***
b139         5.043e+01  1.703e+01   2.962 0.003059 ** 
b140        -3.885e+01  8.598e+00  -4.518 6.25e-06 ***
b141         5.389e+01  1.703e+01   3.164 0.001558 ** 
b142        -4.183e+01  8.590e+00  -4.869 1.12e-06 ***
b143         5.024e+01  1.701e+01   2.954 0.003138 ** 
b144        -4.154e+01  8.577e+00  -4.843 1.28e-06 ***
b145         5.032e+01  1.701e+01   2.958 0.003098 ** 
b146        -3.942e+01  8.573e+00  -4.599 4.26e-06 ***
b147         5.361e+01  1.703e+01   3.149 0.001640 ** 
b148        -4.419e+01  8.598e+00  -5.140 2.76e-07 ***
b149         5.072e+01  1.703e+01   2.977 0.002909 ** 
b150        -3.794e+01  8.590e+00  -4.417 1.00e-05 ***
b151         4.986e+01  1.701e+01   2.932 0.003375 ** 
b152        -3.889e+01  8.577e+00  -4.534 5.81e-06 ***
b153         4.916e+01  1.701e+01   2.890 0.003860 ** 
b154        -4.360e+01  8.573e+00  -5.085 3.69e-07 ***
b155         5.154e+01  1.703e+01   3.027 0.002471 ** 
b156        -4.156e+01  8.598e+00  -4.833 1.35e-06 ***
b157         5.041e+01  1.703e+01   2.959 0.003087 ** 
b158        -4.022e+01  8.591e+00  -4.681 2.86e-06 ***
b159         4.999e+01  1.701e+01   2.939 0.003291 ** 
b160        -3.889e+01  8.577e+00  -4.534 5.81e-06 ***
b161         5.148e+01  1.701e+01   3.026 0.002478 ** 
b162        -4.651e+01  8.573e+00  -5.425 5.83e-08 ***
b163         5.425e+01  1.703e+01   3.186 0.001442 ** 
b164        -4.111e+01  8.598e+00  -4.781 1.75e-06 ***
b165         5.275e+01  1.703e+01   3.097 0.001959 ** 
b166        -4.490e+01  8.590e+00  -5.227 1.73e-07 ***
b167         5.486e+01  1.701e+01   3.225 0.001258 ** 
b168        -4.665e+01  8.577e+00  -5.438 5.41e-08 ***
b169         5.227e+01  1.701e+01   3.072 0.002126 ** 
b170        -4.337e+01  8.572e+00  -5.059 4.23e-07 ***
b171         5.291e+01  1.703e+01   3.108 0.001887 ** 
b172        -4.461e+01  8.598e+00  -5.188 2.13e-07 ***
b173         5.295e+01  1.703e+01   3.108 0.001882 ** 
b174        -4.215e+01  8.590e+00  -4.907 9.28e-07 ***
b175         4.894e+01  1.701e+01   2.878 0.004008 ** 
b176        -3.837e+01  8.577e+00  -4.474 7.69e-06 ***
b177         5.050e+01  1.701e+01   2.969 0.002994 ** 
b178        -3.868e+01  8.571e+00  -4.513 6.41e-06 ***
b179         5.419e+01  1.702e+01   3.183 0.001458 ** 
b180        -4.822e+01  8.599e+00  -5.608 2.06e-08 ***
b181         5.951e+01  1.704e+01   3.492 0.000480 ***
b182        -5.007e+01  8.962e+00  -5.587 2.33e-08 ***
b183         5.480e+01  1.705e+01   3.215 0.001307 ** 
b184        -4.033e+01  8.598e+00  -4.690 2.74e-06 ***
b185         5.089e+01  1.702e+01   2.990 0.002791 ** 
b186        -3.842e+01  8.577e+00  -4.479 7.52e-06 ***
b187         5.296e+01  1.703e+01   3.110 0.001870 ** 
b188        -4.199e+01  8.599e+00  -4.884 1.05e-06 ***
b189         4.966e+01  1.703e+01   2.916 0.003552 ** 
b190        -3.787e+01  8.591e+00  -4.408 1.05e-05 ***
b191         5.139e+01  1.701e+01   3.022 0.002515 ** 
b192        -4.096e+01  8.581e+00  -4.773 1.82e-06 ***
b193         5.196e+01  1.701e+01   3.054 0.002258 ** 
b194        -4.410e+01  8.573e+00  -5.144 2.69e-07 ***
b195         5.250e+01  1.703e+01   3.084 0.002047 ** 
b196        -4.303e+01  8.606e+00  -5.000 5.74e-07 ***
b197         5.135e+01  1.704e+01   3.014 0.002581 ** 
b198        -3.842e+01  8.592e+00  -4.472 7.78e-06 ***
b199         5.237e+01  1.701e+01   3.079 0.002078 ** 
b200        -3.998e+01  8.578e+00  -4.661 3.16e-06 ***
b201         5.170e+01  1.701e+01   3.039 0.002373 ** 
b202        -4.135e+01  8.573e+00  -4.823 1.42e-06 ***
b203         5.092e+01  1.703e+01   2.991 0.002783 ** 
b204        -3.901e+01  8.598e+00  -4.537 5.73e-06 ***
b205         5.174e+01  1.703e+01   3.038 0.002385 ** 
b206        -4.200e+01  8.590e+00  -4.889 1.02e-06 ***
b207         5.082e+01  1.701e+01   2.988 0.002806 ** 
b208        -3.763e+01  8.577e+00  -4.387 1.15e-05 ***
b209         5.410e+01  1.701e+01   3.180 0.001472 ** 
b210        -4.459e+01  8.572e+00  -5.201 1.99e-07 ***
b211         5.353e+01  1.702e+01   3.144 0.001666 ** 
b212        -4.052e+01  8.596e+00  -4.714 2.44e-06 ***
b213         5.323e+01  1.703e+01   3.126 0.001774 ** 
b214        -4.191e+01  8.584e+00  -4.882 1.05e-06 ***
b215         5.358e+01  1.699e+01   3.153 0.001618 ** 
b216        -4.385e+01  8.564e+00  -5.121 3.05e-07 ***
b217         5.121e+01  1.703e+01   3.007 0.002643 ** 
b218        -4.379e+01  8.586e+00  -5.100 3.42e-07 ***
b219         5.199e+01  1.703e+01   3.053 0.002269 ** 
b220        -3.970e+01  8.601e+00  -4.615 3.94e-06 ***
b221         5.353e+01  1.704e+01   3.143 0.001676 ** 
b222        -3.965e+01  8.591e+00  -4.615 3.95e-06 ***
b223         4.919e+01  1.701e+01   2.892 0.003828 ** 
b224        -3.800e+01  8.577e+00  -4.430 9.45e-06 ***
b225         4.895e+01  1.701e+01   2.878 0.004009 ** 
b226        -3.926e+01  8.572e+00  -4.579 4.68e-06 ***
b227         4.984e+01  1.703e+01   2.927 0.003420 ** 
b228        -3.947e+01  8.598e+00  -4.591 4.42e-06 ***
b229         4.738e+01  1.703e+01   2.781 0.005415 ** 
b230        -3.599e+01  8.591e+00  -4.190 2.80e-05 ***
b231         4.967e+01  1.701e+01   2.921 0.003494 ** 
b232        -4.013e+01  8.577e+00  -4.679 2.89e-06 ***
b233         5.249e+01  1.701e+01   3.085 0.002034 ** 
b234        -4.058e+01  8.579e+00  -4.730 2.26e-06 ***
b235         5.221e+01  1.702e+01   3.067 0.002164 ** 
b236        -4.071e+01  8.595e+00  -4.736 2.18e-06 ***
b237         5.280e+01  1.703e+01   3.101 0.001929 ** 
b238        -4.123e+01  8.582e+00  -4.804 1.56e-06 ***
b239         5.315e+01  1.700e+01   3.128 0.001764 ** 
b240        -4.297e+01  8.578e+00  -5.009 5.49e-07 ***
b241         5.216e+01  1.702e+01   3.064 0.002187 ** 
b242        -4.284e+01  8.577e+00  -4.994 5.92e-07 ***
b243         5.029e+01  1.702e+01   2.954 0.003141 ** 
b244        -3.449e+01  8.663e+00  -3.982 6.85e-05 ***
b245         4.997e+01  1.706e+01   2.930 0.003393 ** 
b246        -4.321e+01  8.719e+00  -4.956 7.21e-07 ***
b247         5.033e+01  1.703e+01   2.955 0.003130 ** 
b248        -4.114e+01  8.589e+00  -4.790 1.67e-06 ***
b249         5.249e+01  1.701e+01   3.085 0.002037 ** 
b250        -4.075e+01  8.566e+00  -4.757 1.97e-06 ***
b251         5.354e+01  1.700e+01   3.149 0.001641 ** 
b252        -4.161e+01  8.566e+00  -4.858 1.19e-06 ***
b253         5.119e+01  1.697e+01   3.016 0.002561 ** 
b254        -3.908e+01  8.553e+00  -4.569 4.92e-06 ***
b255         6.050e+01  1.723e+01   3.511 0.000447 ***
b256        -6.493e+01  1.064e+02  -0.610 0.541860    
b257        -3.948e+02  2.007e+02  -1.967 0.049216 *  
b258         6.535e+01  1.825e+01   3.581 0.000343 ***
b259        -4.549e+01  8.797e+00  -5.170 2.35e-07 ***
b260         5.609e+01  1.708e+01   3.284 0.001024 ** 
b261        -4.449e+01  8.606e+00  -5.170 2.35e-07 ***
b262         5.373e+01  1.700e+01   3.161 0.001573 ** 
b263        -4.147e+01  8.526e+00  -4.863 1.16e-06 ***
b264         2.617e+01  1.063e+01   2.462 0.013834 *  
b265         2.482e+01  8.942e+00   2.776 0.005510 ** 
b266         1.818e+02  5.014e+02   0.363 0.716969    
---
Signif. codes:  0 ‘***’ 0.001 ‘**’ 0.01 ‘*’ 0.05 ‘.’ 0.1 ‘ ’ 1

Residual standard error: 4.707 on 44628 degrees of freedom
  (4601 observations deleted due to missingness)
Multiple R-squared:  0.7265,	Adjusted R-squared:  0.7248 
F-statistic: 408.9 on 290 and 44628 DF,  p-value: < 2.2e-16

> # Ottawa
> summary(lms[[2]])

Call:
lm(formula = "mean_temp~.", data = data[row_ids[, k], x_cols])

Residuals:
     Min       1Q   Median       3Q      Max 
-20.8390  -3.0201  -0.0445   3.0388  18.3472 

Coefficients: (1 not defined because of singularities)
              Estimate Std. Error t value Pr(>|t|)    
(Intercept)  3.579e+01  1.837e+01   1.948 0.051430 .  
s1          -9.665e+00  7.765e-01 -12.446  < 2e-16 ***
s2          -1.027e+00  3.032e-02 -33.881  < 2e-16 ***
s3          -4.959e-01  4.087e-02 -12.134  < 2e-16 ***
s4           1.673e-01  3.025e-02   5.531 3.20e-08 ***
s5           1.298e-01  3.073e-02   4.223 2.42e-05 ***
s6           9.407e-02  3.025e-02   3.109 0.001877 ** 
s7           7.649e-02  3.029e-02   2.525 0.011573 *  
s8           1.031e-01  3.025e-02   3.408 0.000654 ***
s9           1.909e-02  3.025e-02   0.631 0.528169    
s10         -4.891e-04  3.024e-02  -0.016 0.987098    
s11         -5.412e-02  3.024e-02  -1.789 0.073546 .  
s12         -1.245e-01  3.024e-02  -4.117 3.85e-05 ***
c1           7.290e+00  3.993e+00   1.826 0.067924 .  
c2          -7.653e-01  3.030e-02 -25.255  < 2e-16 ***
c3           1.740e-01  5.187e-02   3.354 0.000796 ***
c4          -5.326e-02  3.027e-02  -1.760 0.078472 .  
c5          -3.704e-02  3.046e-02  -1.216 0.224042    
c6           1.689e-01  3.025e-02   5.584 2.36e-08 ***
c7           1.029e-01  3.025e-02   3.403 0.000668 ***
c8           2.198e-02  3.025e-02   0.727 0.467425    
c9           4.497e-02  3.024e-02   1.487 0.136993    
c10          3.014e-02  3.024e-02   0.997 0.318898    
c11         -3.510e-02  3.024e-02  -1.161 0.245776    
c12          3.348e-02  3.024e-02   1.107 0.268380    
b1          -8.305e+02  5.333e+02  -1.557 0.119407    
b2           4.590e+01  2.097e+01   2.189 0.028598 *  
b3          -9.892e+01  2.345e+01  -4.219 2.46e-05 ***
b4           3.785e+01  2.044e+01   1.852 0.064065 .  
b5          -1.006e+02  2.363e+01  -4.257 2.07e-05 ***
b6           3.911e+01  2.049e+01   1.908 0.056341 .  
b7          -9.821e+01  2.367e+01  -4.149 3.34e-05 ***
b8           3.896e+01  2.051e+01   1.899 0.057518 .  
b9          -1.020e+02  2.368e+01  -4.306 1.67e-05 ***
b10          3.882e+01  2.053e+01   1.891 0.058586 .  
b11         -1.000e+02  2.370e+01  -4.220 2.45e-05 ***
b12          4.055e+01  2.053e+01   1.975 0.048278 *  
b13         -1.005e+02  2.370e+01  -4.241 2.23e-05 ***
b14          3.973e+01  2.052e+01   1.936 0.052826 .  
b15         -1.006e+02  2.369e+01  -4.245 2.19e-05 ***
b16          3.921e+01  2.052e+01   1.911 0.056057 .  
b17         -9.897e+01  2.369e+01  -4.178 2.95e-05 ***
b18          3.904e+01  2.053e+01   1.902 0.057220 .  
b19         -9.951e+01  2.371e+01  -4.197 2.71e-05 ***
b20          4.214e+01  2.054e+01   2.052 0.040191 *  
b21         -1.009e+02  2.371e+01  -4.254 2.10e-05 ***
b22          3.965e+01  2.054e+01   1.931 0.053543 .  
b23         -9.906e+01  2.371e+01  -4.177 2.95e-05 ***
b24          3.984e+01  2.054e+01   1.939 0.052452 .  
b25         -9.928e+01  2.372e+01  -4.186 2.85e-05 ***
b26          3.992e+01  2.054e+01   1.944 0.051953 .  
b27         -9.891e+01  2.371e+01  -4.171 3.04e-05 ***
b28          3.948e+01  2.054e+01   1.922 0.054574 .  
b29         -1.004e+02  2.370e+01  -4.234 2.30e-05 ***
b30          4.294e+01  2.052e+01   2.093 0.036382 *  
b31         -1.064e+02  2.369e+01  -4.493 7.05e-06 ***
b32          4.254e+01  2.052e+01   2.073 0.038209 *  
b33         -1.059e+02  2.369e+01  -4.469 7.89e-06 ***
b34          4.114e+01  2.053e+01   2.004 0.045084 *  
b35         -1.008e+02  2.371e+01  -4.253 2.11e-05 ***
b36          4.174e+01  2.053e+01   2.033 0.042082 *  
b37         -1.024e+02  2.370e+01  -4.319 1.57e-05 ***
b38          3.809e+01  2.052e+01   1.856 0.063403 .  
b39         -1.010e+02  2.369e+01  -4.264 2.01e-05 ***
b40          4.002e+01  2.052e+01   1.950 0.051157 .  
b41         -9.850e+01  2.369e+01  -4.158 3.22e-05 ***
b42          3.721e+01  2.053e+01   1.812 0.069945 .  
b43         -9.731e+01  2.371e+01  -4.105 4.06e-05 ***
b44          4.134e+01  2.053e+01   2.013 0.044091 *  
b45         -1.037e+02  2.370e+01  -4.373 1.23e-05 ***
b46          4.298e+01  2.052e+01   2.095 0.036220 *  
b47         -1.016e+02  2.369e+01  -4.287 1.82e-05 ***
b48          3.724e+01  2.052e+01   1.815 0.069589 .  
b49         -9.640e+01  2.369e+01  -4.069 4.72e-05 ***
b50          3.851e+01  2.053e+01   1.876 0.060675 .  
b51         -9.769e+01  2.371e+01  -4.121 3.79e-05 ***
b52          3.758e+01  2.053e+01   1.830 0.067243 .  
b53         -9.813e+01  2.370e+01  -4.140 3.48e-05 ***
b54          4.026e+01  2.052e+01   1.962 0.049757 *  
b55         -1.003e+02  2.369e+01  -4.232 2.32e-05 ***
b56          4.020e+01  2.052e+01   1.959 0.050151 .  
b57         -1.016e+02  2.369e+01  -4.287 1.81e-05 ***
b58          3.956e+01  2.053e+01   1.927 0.053979 .  
b59         -1.042e+02  2.371e+01  -4.394 1.12e-05 ***
b60          4.064e+01  2.053e+01   1.979 0.047792 *  
b61         -9.985e+01  2.370e+01  -4.213 2.53e-05 ***
b62          4.229e+01  2.052e+01   2.061 0.039327 *  
b63         -1.035e+02  2.369e+01  -4.368 1.25e-05 ***
b64          4.074e+01  2.052e+01   1.985 0.047146 *  
b65         -9.834e+01  2.369e+01  -4.151 3.31e-05 ***
b66          4.374e+01  2.053e+01   2.131 0.033128 *  
b67         -1.024e+02  2.371e+01  -4.319 1.57e-05 ***
b68          4.303e+01  2.053e+01   2.096 0.036107 *  
b69         -1.022e+02  2.370e+01  -4.314 1.61e-05 ***
b70          3.723e+01  2.052e+01   1.814 0.069620 .  
b71         -9.579e+01  2.369e+01  -4.043 5.29e-05 ***
b72          3.514e+01  2.052e+01   1.712 0.086879 .  
b73         -9.705e+01  2.369e+01  -4.097 4.19e-05 ***
b74          3.792e+01  2.053e+01   1.847 0.064755 .  
b75         -9.983e+01  2.371e+01  -4.211 2.55e-05 ***
b76          3.513e+01  2.053e+01   1.711 0.087084 .  
b77         -9.783e+01  2.370e+01  -4.127 3.67e-05 ***
b78          3.700e+01  2.052e+01   1.803 0.071359 .  
b79         -9.691e+01  2.369e+01  -4.090 4.31e-05 ***
b80          3.554e+01  2.052e+01   1.732 0.083319 .  
b81         -9.743e+01  2.369e+01  -4.113 3.92e-05 ***
b82          3.674e+01  2.053e+01   1.790 0.073510 .  
b83         -9.912e+01  2.371e+01  -4.181 2.91e-05 ***
b84          3.813e+01  2.053e+01   1.857 0.063317 .  
b85         -9.806e+01  2.370e+01  -4.137 3.52e-05 ***
b86          3.895e+01  2.052e+01   1.898 0.057684 .  
b87         -9.530e+01  2.369e+01  -4.022 5.78e-05 ***
b88          3.555e+01  2.052e+01   1.732 0.083230 .  
b89         -9.714e+01  2.369e+01  -4.100 4.13e-05 ***
b90          4.215e+01  2.053e+01   2.053 0.040054 *  
b91         -1.085e+02  2.371e+01  -4.578 4.71e-06 ***
b92          4.187e+01  2.053e+01   2.039 0.041419 *  
b93         -1.029e+02  2.370e+01  -4.340 1.42e-05 ***
b94          3.955e+01  2.052e+01   1.927 0.053939 .  
b95         -1.013e+02  2.369e+01  -4.276 1.91e-05 ***
b96          3.823e+01  2.052e+01   1.863 0.062490 .  
b97         -9.920e+01  2.369e+01  -4.188 2.82e-05 ***
b98          4.085e+01  2.053e+01   1.990 0.046632 *  
b99         -1.018e+02  2.371e+01  -4.293 1.76e-05 ***
b100         4.107e+01  2.053e+01   2.000 0.045482 *  
b101        -1.010e+02  2.370e+01  -4.262 2.03e-05 ***
b102         3.836e+01  2.052e+01   1.870 0.061550 .  
b103        -1.012e+02  2.369e+01  -4.270 1.96e-05 ***
b104         3.807e+01  2.052e+01   1.855 0.063617 .  
b105        -1.006e+02  2.369e+01  -4.248 2.16e-05 ***
b106         4.004e+01  2.053e+01   1.950 0.051141 .  
b107        -9.992e+01  2.371e+01  -4.215 2.51e-05 ***
b108         4.230e+01  2.053e+01   2.060 0.039394 *  
b109        -1.041e+02  2.370e+01  -4.390 1.13e-05 ***
b110         3.996e+01  2.052e+01   1.947 0.051485 .  
b111        -1.017e+02  2.369e+01  -4.293 1.77e-05 ***
b112         4.164e+01  2.052e+01   2.029 0.042480 *  
b113        -1.015e+02  2.369e+01  -4.286 1.82e-05 ***
b114         4.026e+01  2.053e+01   1.961 0.049882 *  
b115        -1.009e+02  2.371e+01  -4.258 2.07e-05 ***
b116         3.999e+01  2.053e+01   1.948 0.051470 .  
b117        -1.000e+02  2.370e+01  -4.219 2.46e-05 ***
b118         3.875e+01  2.052e+01   1.888 0.059000 .  
b119        -9.909e+01  2.369e+01  -4.182 2.89e-05 ***
b120         3.699e+01  2.052e+01   1.802 0.071493 .  
b121        -9.386e+01  2.369e+01  -3.962 7.44e-05 ***
b122         3.748e+01  2.053e+01   1.825 0.067940 .  
b123        -9.618e+01  2.371e+01  -4.057 4.98e-05 ***
b124         3.485e+01  2.053e+01   1.697 0.089626 .  
b125        -9.505e+01  2.370e+01  -4.010 6.08e-05 ***
b126         3.656e+01  2.052e+01   1.781 0.074841 .  
b127        -9.660e+01  2.369e+01  -4.077 4.56e-05 ***
b128         3.699e+01  2.052e+01   1.802 0.071518 .  
b129        -9.421e+01  2.369e+01  -3.977 6.99e-05 ***
b130         3.786e+01  2.053e+01   1.844 0.065174 .  
b131        -9.557e+01  2.371e+01  -4.031 5.55e-05 ***
b132         3.701e+01  2.053e+01   1.803 0.071470 .  
b133        -9.931e+01  2.370e+01  -4.190 2.80e-05 ***
b134         4.127e+01  2.052e+01   2.011 0.044298 *  
b135        -9.864e+01  2.369e+01  -4.163 3.15e-05 ***
b136         3.524e+01  2.052e+01   1.717 0.085998 .  
b137        -9.651e+01  2.369e+01  -4.074 4.63e-05 ***
b138         3.752e+01  2.053e+01   1.828 0.067606 .  
b139        -9.585e+01  2.371e+01  -4.043 5.28e-05 ***
b140         3.832e+01  2.053e+01   1.866 0.061996 .  
b141        -1.021e+02  2.370e+01  -4.306 1.67e-05 ***
b142         4.096e+01  2.052e+01   1.996 0.045915 *  
b143        -9.891e+01  2.369e+01  -4.175 2.99e-05 ***
b144         3.919e+01  2.052e+01   1.909 0.056218 .  
b145        -9.847e+01  2.369e+01  -4.157 3.24e-05 ***
b146         3.814e+01  2.053e+01   1.858 0.063168 .  
b147        -9.677e+01  2.371e+01  -4.082 4.47e-05 ***
b148         3.819e+01  2.053e+01   1.860 0.062884 .  
b149        -9.979e+01  2.370e+01  -4.210 2.55e-05 ***
b150         3.769e+01  2.052e+01   1.837 0.066237 .  
b151        -9.660e+01  2.369e+01  -4.077 4.57e-05 ***
b152         3.792e+01  2.052e+01   1.848 0.064620 .  
b153        -9.799e+01  2.369e+01  -4.137 3.53e-05 ***
b154         3.693e+01  2.053e+01   1.799 0.072070 .  
b155        -9.669e+01  2.371e+01  -4.079 4.54e-05 ***
b156         3.830e+01  2.053e+01   1.865 0.062172 .  
b157        -9.800e+01  2.370e+01  -4.135 3.56e-05 ***
b158         3.752e+01  2.052e+01   1.829 0.067477 .  
b159        -9.854e+01  2.369e+01  -4.159 3.20e-05 ***
b160         3.955e+01  2.052e+01   1.927 0.053986 .  
b161        -9.855e+01  2.369e+01  -4.160 3.19e-05 ***
b162         3.988e+01  2.053e+01   1.943 0.052066 .  
b163        -1.011e+02  2.371e+01  -4.264 2.01e-05 ***
b164         4.080e+01  2.053e+01   1.987 0.046913 *  
b165        -1.006e+02  2.370e+01  -4.244 2.20e-05 ***
b166         3.866e+01  2.052e+01   1.884 0.059587 .  
b167        -9.762e+01  2.369e+01  -4.120 3.79e-05 ***
b168         3.605e+01  2.052e+01   1.757 0.078957 .  
b169        -9.775e+01  2.369e+01  -4.126 3.69e-05 ***
b170         4.053e+01  2.053e+01   1.974 0.048349 *  
b171        -9.829e+01  2.371e+01  -4.146 3.39e-05 ***
b172         3.727e+01  2.053e+01   1.815 0.069501 .  
b173        -9.773e+01  2.370e+01  -4.123 3.74e-05 ***
b174         4.078e+01  2.052e+01   1.987 0.046909 *  
b175        -9.955e+01  2.369e+01  -4.202 2.66e-05 ***
b176         4.012e+01  2.052e+01   1.955 0.050628 .  
b177        -1.021e+02  2.369e+01  -4.312 1.62e-05 ***
b178         4.311e+01  2.053e+01   2.100 0.035759 *  
b179        -1.024e+02  2.371e+01  -4.319 1.57e-05 ***
b180         4.040e+01  2.053e+01   1.968 0.049129 *  
b181        -9.929e+01  2.370e+01  -4.189 2.81e-05 ***
b182         3.912e+01  2.052e+01   1.906 0.056606 .  
b183        -9.672e+01  2.369e+01  -4.082 4.47e-05 ***
b184         3.853e+01  2.052e+01   1.877 0.060469 .  
b185        -1.004e+02  2.369e+01  -4.238 2.26e-05 ***
b186         4.146e+01  2.053e+01   2.019 0.043460 *  
b187        -1.006e+02  2.371e+01  -4.243 2.21e-05 ***
b188         3.843e+01  2.053e+01   1.872 0.061261 .  
b189        -9.601e+01  2.370e+01  -4.051 5.12e-05 ***
b190         3.916e+01  2.052e+01   1.908 0.056382 .  
b191        -9.856e+01  2.369e+01  -4.160 3.19e-05 ***
b192         3.832e+01  2.052e+01   1.867 0.061863 .  
b193        -9.663e+01  2.369e+01  -4.079 4.53e-05 ***
b194         3.738e+01  2.053e+01   1.821 0.068660 .  
b195        -9.608e+01  2.371e+01  -4.053 5.07e-05 ***
b196         3.743e+01  2.053e+01   1.823 0.068318 .  
b197        -9.691e+01  2.370e+01  -4.089 4.34e-05 ***
b198         3.993e+01  2.052e+01   1.946 0.051651 .  
b199        -9.825e+01  2.369e+01  -4.147 3.38e-05 ***
b200         4.026e+01  2.052e+01   1.962 0.049782 *  
b201        -9.881e+01  2.369e+01  -4.171 3.04e-05 ***
b202         3.973e+01  2.053e+01   1.935 0.052937 .  
b203        -9.920e+01  2.371e+01  -4.185 2.86e-05 ***
b204         4.007e+01  2.053e+01   1.951 0.051033 .  
b205        -9.754e+01  2.370e+01  -4.115 3.87e-05 ***
b206         4.186e+01  2.052e+01   2.040 0.041366 *  
b207        -9.937e+01  2.369e+01  -4.194 2.74e-05 ***
b208         3.748e+01  2.052e+01   1.826 0.067841 .  
b209        -9.842e+01  2.369e+01  -4.155 3.26e-05 ***
b210         3.971e+01  2.053e+01   1.934 0.053107 .  
b211        -1.009e+02  2.371e+01  -4.257 2.08e-05 ***
b212         3.858e+01  2.053e+01   1.879 0.060231 .  
b213        -9.535e+01  2.370e+01  -4.023 5.75e-05 ***
b214         3.981e+01  2.052e+01   1.940 0.052404 .  
b215        -1.001e+02  2.369e+01  -4.227 2.37e-05 ***
b216         3.887e+01  2.052e+01   1.894 0.058240 .  
b217        -9.611e+01  2.369e+01  -4.057 4.98e-05 ***
b218         3.608e+01  2.053e+01   1.757 0.078870 .  
b219        -9.500e+01  2.371e+01  -4.007 6.15e-05 ***
b220         4.056e+01  2.053e+01   1.975 0.048224 *  
b221        -9.580e+01  2.370e+01  -4.042 5.31e-05 ***
b222         3.986e+01  2.052e+01   1.942 0.052112 .  
b223        -9.457e+01  2.369e+01  -3.991 6.58e-05 ***
b224         3.799e+01  2.052e+01   1.851 0.064184 .  
b225        -9.794e+01  2.369e+01  -4.134 3.56e-05 ***
b226         3.931e+01  2.053e+01   1.915 0.055511 .  
b227        -9.274e+01  2.371e+01  -3.912 9.17e-05 ***
b228         3.863e+01  2.053e+01   1.881 0.059938 .  
b229        -9.858e+01  2.370e+01  -4.159 3.20e-05 ***
b230         3.882e+01  2.052e+01   1.892 0.058550 .  
b231        -9.679e+01  2.369e+01  -4.085 4.41e-05 ***
b232         3.887e+01  2.052e+01   1.894 0.058258 .  
b233        -9.770e+01  2.369e+01  -4.124 3.73e-05 ***
b234         3.946e+01  2.053e+01   1.922 0.054615 .  
b235        -9.393e+01  2.371e+01  -3.962 7.43e-05 ***
b236         3.844e+01  2.053e+01   1.872 0.061229 .  
b237        -9.496e+01  2.370e+01  -4.007 6.17e-05 ***
b238         3.749e+01  2.052e+01   1.827 0.067698 .  
b239        -9.471e+01  2.369e+01  -3.997 6.41e-05 ***
b240         3.701e+01  2.052e+01   1.803 0.071326 .  
b241        -9.651e+01  2.369e+01  -4.074 4.63e-05 ***
b242         3.673e+01  2.053e+01   1.789 0.073622 .  
b243        -9.409e+01  2.371e+01  -3.969 7.24e-05 ***
b244         4.153e+01  2.053e+01   2.023 0.043127 *  
b245        -9.843e+01  2.370e+01  -4.153 3.29e-05 ***
b246         3.999e+01  2.052e+01   1.949 0.051315 .  
b247        -9.373e+01  2.369e+01  -3.956 7.63e-05 ***
b248         4.125e+01  2.052e+01   2.010 0.044424 *  
b249        -9.761e+01  2.369e+01  -4.120 3.79e-05 ***
b250         4.130e+01  2.053e+01   2.012 0.044249 *  
b251        -1.011e+02  2.371e+01  -4.266 2.00e-05 ***
b252         4.064e+01  2.053e+01   1.979 0.047772 *  
b253        -9.927e+01  2.370e+01  -4.188 2.81e-05 ***
b254         3.819e+01  2.052e+01   1.861 0.062702 .  
b255        -9.237e+01  2.369e+01  -3.899 9.68e-05 ***
b256         3.698e+01  2.052e+01   1.802 0.071538 .  
b257        -9.311e+01  2.369e+01  -3.931 8.48e-05 ***
b258         3.769e+01  2.053e+01   1.836 0.066370 .  
b259        -9.615e+01  2.371e+01  -4.056 5.00e-05 ***
b260         4.038e+01  2.053e+01   1.967 0.049226 *  
b261        -9.841e+01  2.370e+01  -4.152 3.30e-05 ***
b262         3.712e+01  2.052e+01   1.810 0.070370 .  
b263        -9.472e+01  2.369e+01  -3.998 6.40e-05 ***
b264         4.017e+01  2.052e+01   1.958 0.050290 .  
b265        -9.528e+01  2.370e+01  -4.020 5.83e-05 ***
b266         4.015e+01  2.050e+01   1.959 0.050167 .  
b267        -9.476e+01  2.373e+01  -3.993 6.54e-05 ***
b268         3.743e+01  2.042e+01   1.833 0.066790 .  
b269        -9.209e+01  2.382e+01  -3.867 0.000110 ***
b270         3.594e+00  1.799e+01   0.200 0.841656    
b271        -6.991e+00  1.909e+01  -0.366 0.714128    
b272                NA         NA      NA       NA    
---
Signif. codes:  0 ‘***’ 0.001 ‘**’ 0.01 ‘*’ 0.05 ‘.’ 0.1 ‘ ’ 1

Residual standard error: 4.717 on 48380 degrees of freedom
  (478 observations deleted due to missingness)
Multiple R-squared:  0.8531,	Adjusted R-squared:  0.8522 
F-statistic: 952.4 on 295 and 48380 DF,  p-value: < 2.2e-16

> # Toronto
> summary(lms[[3]])

Call:
lm(formula = "mean_temp~.", data = data[row_ids[, k], x_cols])

Residuals:
     Min       1Q   Median       3Q      Max 
-20.3314  -2.6863  -0.0101   2.7862  16.0456 

Coefficients:
              Estimate Std. Error t value Pr(>|t|)    
(Intercept)  7.588e+00  7.139e+00   1.063 0.287867    
s1          -6.793e+00  3.390e-01 -20.041  < 2e-16 ***
s2          -1.067e-01  2.404e-02  -4.438 9.11e-06 ***
s3          -3.174e-01  2.682e-02 -11.836  < 2e-16 ***
s4           9.161e-02  2.400e-02   3.817 0.000135 ***
s5           1.399e-01  2.411e-02   5.803 6.53e-09 ***
s6           9.821e-02  2.399e-02   4.093 4.26e-05 ***
s7           1.515e-02  2.400e-02   0.631 0.528062    
s8           8.385e-02  2.399e-02   3.495 0.000475 ***
s9           2.977e-02  2.399e-02   1.241 0.214680    
s10         -3.493e-02  2.399e-02  -1.456 0.145456    
s11         -3.234e-02  2.399e-02  -1.348 0.177654    
s12         -3.699e-02  2.399e-02  -1.542 0.123138    
c1          -3.598e+00  1.827e+00  -1.970 0.048862 *  
c2           1.788e-02  2.401e-02   0.745 0.456479    
c3           2.045e-01  3.094e-02   6.610 3.88e-11 ***
c4           2.967e-02  2.399e-02   1.236 0.216312    
c5          -1.188e-01  2.406e-02  -4.936 7.99e-07 ***
c6           1.670e-01  2.399e-02   6.958 3.48e-12 ***
c7           5.132e-02  2.399e-02   2.139 0.032463 *  
c8          -2.380e-02  2.399e-02  -0.992 0.321201    
c9          -1.240e-03  2.399e-02  -0.052 0.958783    
c10          1.069e-02  2.399e-02   0.446 0.655860    
c11         -7.863e-02  2.399e-02  -3.277 0.001050 ** 
c12          1.667e-02  2.399e-02   0.695 0.487167    
b1          -4.672e+00  8.478e+00  -0.551 0.581589    
b2           2.184e+01  9.726e+00   2.245 0.024750 *  
b3          -2.594e+01  7.851e+00  -3.304 0.000953 ***
b4           2.369e+01  1.031e+01   2.298 0.021588 *  
b5          -2.371e+01  7.681e+00  -3.087 0.002021 ** 
b6           2.435e+01  1.040e+01   2.341 0.019214 *  
b7          -2.679e+01  7.637e+00  -3.509 0.000451 ***
b8           2.265e+01  1.042e+01   2.174 0.029681 *  
b9          -2.413e+01  7.622e+00  -3.166 0.001547 ** 
b10          2.466e+01  1.042e+01   2.365 0.018018 *  
b11         -2.509e+01  7.617e+00  -3.294 0.000987 ***
b12          2.512e+01  1.043e+01   2.409 0.016016 *  
b13         -2.815e+01  7.622e+00  -3.693 0.000222 ***
b14          2.720e+01  1.043e+01   2.607 0.009135 ** 
b15         -2.547e+01  7.620e+00  -3.342 0.000833 ***
b16          2.156e+01  1.042e+01   2.068 0.038602 *  
b17         -2.342e+01  7.617e+00  -3.074 0.002111 ** 
b18          2.317e+01  1.043e+01   2.222 0.026283 *  
b19         -2.603e+01  7.616e+00  -3.418 0.000632 ***
b20          2.239e+01  1.043e+01   2.147 0.031813 *  
b21         -2.314e+01  7.622e+00  -3.036 0.002401 ** 
b22          2.274e+01  1.043e+01   2.179 0.029310 *  
b23         -2.551e+01  7.620e+00  -3.348 0.000815 ***
b24          2.475e+01  1.043e+01   2.374 0.017588 *  
b25         -2.881e+01  7.617e+00  -3.782 0.000156 ***
b26          2.380e+01  1.043e+01   2.283 0.022446 *  
b27         -2.565e+01  7.616e+00  -3.367 0.000760 ***
b28          2.521e+01  1.043e+01   2.416 0.015678 *  
b29         -2.837e+01  7.622e+00  -3.722 0.000198 ***
b30          2.692e+01  1.043e+01   2.580 0.009894 ** 
b31         -2.828e+01  7.620e+00  -3.712 0.000206 ***
b32          2.668e+01  1.043e+01   2.559 0.010504 *  
b33         -3.050e+01  7.617e+00  -4.003 6.25e-05 ***
b34          2.546e+01  1.043e+01   2.442 0.014617 *  
b35         -2.865e+01  7.616e+00  -3.762 0.000169 ***
b36          2.292e+01  1.043e+01   2.197 0.028030 *  
b37         -2.479e+01  7.622e+00  -3.252 0.001146 ** 
b38          2.364e+01  1.043e+01   2.266 0.023474 *  
b39         -2.384e+01  7.620e+00  -3.128 0.001761 ** 
b40          2.429e+01  1.043e+01   2.330 0.019803 *  
b41         -2.700e+01  7.617e+00  -3.545 0.000393 ***
b42          2.572e+01  1.043e+01   2.467 0.013624 *  
b43         -2.696e+01  7.616e+00  -3.541 0.000400 ***
b44          2.383e+01  1.043e+01   2.284 0.022359 *  
b45         -2.458e+01  7.622e+00  -3.225 0.001262 ** 
b46          2.309e+01  1.043e+01   2.213 0.026914 *  
b47         -2.386e+01  7.620e+00  -3.131 0.001745 ** 
b48          2.377e+01  1.043e+01   2.280 0.022632 *  
b49         -2.564e+01  7.617e+00  -3.366 0.000763 ***
b50          2.620e+01  1.043e+01   2.513 0.011976 *  
b51         -2.757e+01  7.616e+00  -3.620 0.000295 ***
b52          2.638e+01  1.043e+01   2.529 0.011436 *  
b53         -2.619e+01  7.622e+00  -3.436 0.000592 ***
b54          2.439e+01  1.043e+01   2.337 0.019417 *  
b55         -2.677e+01  7.620e+00  -3.513 0.000443 ***
b56          2.601e+01  1.043e+01   2.495 0.012609 *  
b57         -2.778e+01  7.617e+00  -3.646 0.000266 ***
b58          2.566e+01  1.043e+01   2.461 0.013858 *  
b59         -2.618e+01  7.616e+00  -3.438 0.000587 ***
b60          2.331e+01  1.043e+01   2.234 0.025468 *  
b61         -2.679e+01  7.622e+00  -3.514 0.000441 ***
b62          2.785e+01  1.043e+01   2.669 0.007600 ** 
b63         -2.699e+01  7.620e+00  -3.543 0.000397 ***
b64          2.792e+01  1.043e+01   2.678 0.007399 ** 
b65         -3.160e+01  7.617e+00  -4.148 3.35e-05 ***
b66          2.874e+01  1.043e+01   2.756 0.005849 ** 
b67         -3.131e+01  7.616e+00  -4.111 3.94e-05 ***
b68          2.671e+01  1.043e+01   2.560 0.010460 *  
b69         -2.932e+01  7.622e+00  -3.846 0.000120 ***
b70          2.737e+01  1.043e+01   2.623 0.008731 ** 
b71         -2.972e+01  7.620e+00  -3.900 9.64e-05 ***
b72          2.331e+01  1.043e+01   2.236 0.025380 *  
b73         -2.663e+01  7.617e+00  -3.496 0.000472 ***
b74          2.635e+01  1.043e+01   2.527 0.011511 *  
b75         -2.937e+01  7.616e+00  -3.856 0.000115 ***
b76          2.661e+01  1.043e+01   2.551 0.010740 *  
b77         -2.410e+01  7.622e+00  -3.161 0.001570 ** 
b78          2.848e+01  1.043e+01   2.730 0.006339 ** 
b79         -2.853e+01  7.620e+00  -3.744 0.000181 ***
b80          2.509e+01  1.043e+01   2.406 0.016116 *  
b81         -2.494e+01  7.617e+00  -3.274 0.001060 ** 
b82          2.825e+01  1.043e+01   2.710 0.006736 ** 
b83         -3.182e+01  7.616e+00  -4.177 2.95e-05 ***
b84          2.828e+01  1.043e+01   2.711 0.006718 ** 
b85         -2.416e+01  7.622e+00  -3.169 0.001528 ** 
b86          2.512e+01  1.043e+01   2.407 0.016093 *  
b87         -2.718e+01  7.620e+00  -3.567 0.000361 ***
b88          2.312e+01  1.043e+01   2.217 0.026600 *  
b89         -2.834e+01  7.617e+00  -3.720 0.000199 ***
b90          2.714e+01  1.043e+01   2.603 0.009235 ** 
b91         -3.020e+01  7.616e+00  -3.966 7.33e-05 ***
b92          2.341e+01  1.043e+01   2.244 0.024826 *  
b93         -2.679e+01  7.622e+00  -3.515 0.000439 ***
b94          2.644e+01  1.043e+01   2.534 0.011282 *  
b95         -3.003e+01  7.620e+00  -3.941 8.12e-05 ***
b96          2.836e+01  1.043e+01   2.721 0.006520 ** 
b97         -2.969e+01  7.617e+00  -3.898 9.70e-05 ***
b98          2.395e+01  1.043e+01   2.297 0.021644 *  
b99         -2.433e+01  7.616e+00  -3.195 0.001398 ** 
b100         2.344e+01  1.043e+01   2.247 0.024646 *  
b101        -2.295e+01  7.622e+00  -3.011 0.002604 ** 
b102         2.422e+01  1.043e+01   2.321 0.020268 *  
b103        -2.624e+01  7.620e+00  -3.444 0.000574 ***
b104         2.584e+01  1.043e+01   2.479 0.013186 *  
b105        -2.639e+01  7.617e+00  -3.464 0.000532 ***
b106         2.662e+01  1.043e+01   2.553 0.010670 *  
b107        -2.877e+01  7.616e+00  -3.778 0.000159 ***
b108         2.588e+01  1.043e+01   2.481 0.013115 *  
b109        -2.639e+01  7.622e+00  -3.462 0.000536 ***
b110         2.792e+01  1.043e+01   2.676 0.007454 ** 
b111        -2.797e+01  7.620e+00  -3.671 0.000242 ***
b112         2.656e+01  1.043e+01   2.548 0.010842 *  
b113        -2.778e+01  7.617e+00  -3.647 0.000266 ***
b114         2.756e+01  1.043e+01   2.643 0.008226 ** 
b115        -2.684e+01  7.617e+00  -3.524 0.000425 ***
b116         2.680e+01  1.043e+01   2.569 0.010213 *  
b117        -2.607e+01  7.623e+00  -3.420 0.000626 ***
b118         2.961e+01  1.044e+01   2.836 0.004564 ** 
b119        -2.845e+01  7.625e+00  -3.732 0.000190 ***
b120         2.829e+01  1.044e+01   2.709 0.006747 ** 
b121        -2.756e+01  7.626e+00  -3.614 0.000302 ***
b122         2.821e+01  1.044e+01   2.702 0.006902 ** 
b123        -2.561e+01  7.626e+00  -3.359 0.000783 ***
b124         2.685e+01  1.044e+01   2.572 0.010125 *  
b125        -2.577e+01  7.625e+00  -3.380 0.000725 ***
b126         2.589e+01  1.044e+01   2.480 0.013129 *  
b127        -2.587e+01  7.621e+00  -3.394 0.000689 ***
b128         2.921e+01  1.043e+01   2.802 0.005081 ** 
b129        -3.164e+01  7.618e+00  -4.153 3.28e-05 ***
b130         2.800e+01  1.043e+01   2.685 0.007260 ** 
b131        -3.050e+01  7.616e+00  -4.004 6.23e-05 ***
b132         2.781e+01  1.043e+01   2.666 0.007676 ** 
b133        -2.629e+01  7.622e+00  -3.449 0.000563 ***
b134         2.854e+01  1.044e+01   2.735 0.006236 ** 
b135        -2.742e+01  7.620e+00  -3.599 0.000320 ***
b136         2.530e+01  1.043e+01   2.427 0.015228 *  
b137        -2.651e+01  7.617e+00  -3.480 0.000501 ***
b138         2.691e+01  1.043e+01   2.581 0.009864 ** 
b139        -2.414e+01  7.616e+00  -3.169 0.001529 ** 
b140         2.551e+01  1.043e+01   2.445 0.014489 *  
b141        -2.571e+01  7.622e+00  -3.374 0.000743 ***
b142         2.862e+01  1.044e+01   2.743 0.006094 ** 
b143        -2.896e+01  7.620e+00  -3.800 0.000145 ***
b144         3.103e+01  1.043e+01   2.976 0.002918 ** 
b145        -2.936e+01  7.617e+00  -3.855 0.000116 ***
b146         2.578e+01  1.043e+01   2.473 0.013410 *  
b147        -2.343e+01  7.616e+00  -3.076 0.002098 ** 
b148         2.676e+01  1.043e+01   2.565 0.010330 *  
b149        -2.526e+01  7.622e+00  -3.314 0.000919 ***
b150         2.680e+01  1.044e+01   2.568 0.010236 *  
b151        -2.563e+01  7.620e+00  -3.364 0.000770 ***
b152         2.721e+01  1.043e+01   2.610 0.009064 ** 
b153        -2.653e+01  7.617e+00  -3.483 0.000496 ***
b154         2.793e+01  1.043e+01   2.679 0.007395 ** 
b155        -2.710e+01  7.616e+00  -3.558 0.000374 ***
b156         2.633e+01  1.043e+01   2.524 0.011603 *  
b157        -3.019e+01  7.622e+00  -3.961 7.49e-05 ***
b158         2.832e+01  1.044e+01   2.714 0.006651 ** 
b159        -2.571e+01  7.620e+00  -3.374 0.000742 ***
b160         3.113e+01  1.043e+01   2.986 0.002829 ** 
b161        -2.999e+01  7.617e+00  -3.937 8.26e-05 ***
b162         2.730e+01  1.043e+01   2.618 0.008848 ** 
b163        -2.399e+01  7.616e+00  -3.150 0.001633 ** 
b164         3.093e+01  1.043e+01   2.965 0.003032 ** 
b165        -2.733e+01  7.622e+00  -3.586 0.000337 ***
b166         3.016e+01  1.044e+01   2.890 0.003856 ** 
b167        -2.754e+01  7.620e+00  -3.614 0.000302 ***
b168         2.549e+01  1.043e+01   2.445 0.014505 *  
b169        -2.384e+01  7.617e+00  -3.130 0.001748 ** 
b170         2.385e+01  1.043e+01   2.287 0.022185 *  
b171        -2.521e+01  7.616e+00  -3.310 0.000933 ***
b172         2.701e+01  1.043e+01   2.589 0.009637 ** 
b173        -2.740e+01  7.622e+00  -3.595 0.000324 ***
b174         2.438e+01  1.044e+01   2.337 0.019455 *  
b175        -2.538e+01  7.620e+00  -3.331 0.000866 ***
b176         2.564e+01  1.043e+01   2.459 0.013929 *  
b177        -2.378e+01  7.617e+00  -3.122 0.001797 ** 
b178         2.456e+01  1.043e+01   2.355 0.018520 *  
b179        -2.349e+01  7.616e+00  -3.084 0.002045 ** 
b180         2.585e+01  1.043e+01   2.478 0.013224 *  
b181        -2.621e+01  7.622e+00  -3.439 0.000583 ***
b182         2.777e+01  1.044e+01   2.662 0.007780 ** 
b183        -2.508e+01  7.620e+00  -3.291 0.001000 ***
b184         2.716e+01  1.043e+01   2.606 0.009174 ** 
b185        -2.067e+01  7.617e+00  -2.713 0.006666 ** 
b186         2.462e+01  1.043e+01   2.361 0.018207 *  
b187        -2.400e+01  7.616e+00  -3.151 0.001626 ** 
b188         3.001e+01  1.043e+01   2.877 0.004019 ** 
b189        -3.088e+01  7.622e+00  -4.051 5.10e-05 ***
b190         2.949e+01  1.044e+01   2.826 0.004712 ** 
b191        -2.796e+01  7.620e+00  -3.669 0.000243 ***
b192         2.912e+01  1.043e+01   2.793 0.005221 ** 
b193        -2.867e+01  7.617e+00  -3.763 0.000168 ***
b194         2.848e+01  1.043e+01   2.731 0.006308 ** 
b195        -2.568e+01  7.616e+00  -3.372 0.000747 ***
b196         2.855e+01  1.043e+01   2.737 0.006204 ** 
b197        -2.741e+01  7.622e+00  -3.596 0.000323 ***
b198         3.035e+01  1.044e+01   2.909 0.003632 ** 
b199        -2.731e+01  7.620e+00  -3.585 0.000338 ***
b200         2.912e+01  1.043e+01   2.793 0.005218 ** 
b201        -2.746e+01  7.617e+00  -3.605 0.000312 ***
b202         2.684e+01  1.043e+01   2.574 0.010054 *  
b203        -2.661e+01  7.616e+00  -3.494 0.000476 ***
b204         2.948e+01  1.043e+01   2.826 0.004713 ** 
b205        -2.568e+01  7.622e+00  -3.369 0.000754 ***
b206         2.986e+01  1.044e+01   2.862 0.004217 ** 
b207        -2.872e+01  7.620e+00  -3.769 0.000164 ***
b208         2.894e+01  1.043e+01   2.776 0.005513 ** 
b209        -2.738e+01  7.617e+00  -3.595 0.000325 ***
b210         2.939e+01  1.043e+01   2.819 0.004823 ** 
b211        -2.677e+01  7.616e+00  -3.515 0.000439 ***
b212         2.798e+01  1.043e+01   2.682 0.007312 ** 
b213        -2.622e+01  7.622e+00  -3.440 0.000583 ***
b214         2.879e+01  1.044e+01   2.759 0.005801 ** 
b215        -2.600e+01  7.620e+00  -3.412 0.000645 ***
b216         2.792e+01  1.043e+01   2.678 0.007402 ** 
b217        -2.563e+01  7.617e+00  -3.364 0.000768 ***
b218         2.684e+01  1.043e+01   2.574 0.010063 *  
b219        -2.256e+01  7.616e+00  -2.962 0.003053 ** 
b220         2.852e+01  1.043e+01   2.734 0.006263 ** 
b221        -2.379e+01  7.622e+00  -3.121 0.001800 ** 
b222         2.493e+01  1.044e+01   2.389 0.016897 *  
b223        -2.318e+01  7.620e+00  -3.042 0.002353 ** 
b224         2.730e+01  1.043e+01   2.619 0.008828 ** 
b225        -2.484e+01  7.617e+00  -3.260 0.001113 ** 
b226         2.788e+01  1.043e+01   2.674 0.007506 ** 
b227        -2.308e+01  7.616e+00  -3.030 0.002449 ** 
b228         2.805e+01  1.043e+01   2.689 0.007164 ** 
b229        -2.331e+01  7.622e+00  -3.058 0.002229 ** 
b230         2.740e+01  1.043e+01   2.626 0.008641 ** 
b231        -2.554e+01  7.620e+00  -3.351 0.000805 ***
b232         3.124e+01  1.043e+01   2.997 0.002730 ** 
b233        -2.633e+01  7.617e+00  -3.457 0.000546 ***
b234         2.601e+01  1.043e+01   2.494 0.012625 *  
b235        -2.395e+01  7.616e+00  -3.144 0.001667 ** 
b236         2.788e+01  1.043e+01   2.673 0.007525 ** 
b237        -2.504e+01  7.622e+00  -3.286 0.001018 ** 
b238         2.896e+01  1.043e+01   2.776 0.005512 ** 
b239        -2.896e+01  7.620e+00  -3.800 0.000145 ***
b240         3.160e+01  1.043e+01   3.031 0.002440 ** 
b241        -2.682e+01  7.617e+00  -3.521 0.000430 ***
b242         2.856e+01  1.043e+01   2.738 0.006174 ** 
b243        -2.596e+01  7.616e+00  -3.408 0.000654 ***
b244         2.848e+01  1.043e+01   2.730 0.006341 ** 
b245        -2.539e+01  7.622e+00  -3.332 0.000864 ***
b246         2.935e+01  1.043e+01   2.813 0.004911 ** 
b247        -2.767e+01  7.620e+00  -3.631 0.000283 ***
b248         2.833e+01  1.043e+01   2.718 0.006574 ** 
b249        -2.446e+01  7.617e+00  -3.212 0.001320 ** 
b250         2.763e+01  1.043e+01   2.650 0.008054 ** 
b251        -2.509e+01  7.616e+00  -3.294 0.000989 ***
b252         2.631e+01  1.043e+01   2.522 0.011666 *  
b253        -2.465e+01  7.622e+00  -3.234 0.001222 ** 
b254         2.760e+01  1.043e+01   2.644 0.008183 ** 
b255        -2.507e+01  7.620e+00  -3.290 0.001003 ** 
b256         2.708e+01  1.043e+01   2.598 0.009380 ** 
b257        -2.662e+01  7.617e+00  -3.495 0.000475 ***
b258         2.895e+01  1.043e+01   2.776 0.005499 ** 
b259        -2.648e+01  7.616e+00  -3.477 0.000507 ***
b260         3.016e+01  1.043e+01   2.891 0.003837 ** 
b261        -2.854e+01  7.622e+00  -3.745 0.000181 ***
b262         3.073e+01  1.043e+01   2.945 0.003233 ** 
b263        -2.692e+01  7.620e+00  -3.532 0.000412 ***
b264         2.849e+01  1.043e+01   2.732 0.006291 ** 
b265        -2.386e+01  7.617e+00  -3.132 0.001737 ** 
b266         2.599e+01  1.043e+01   2.493 0.012672 *  
b267        -2.427e+01  7.616e+00  -3.186 0.001442 ** 
b268         2.920e+01  1.043e+01   2.799 0.005130 ** 
b269        -2.442e+01  7.622e+00  -3.204 0.001358 ** 
b270         2.678e+01  1.043e+01   2.566 0.010293 *  
b271        -2.404e+01  7.620e+00  -3.155 0.001608 ** 
b272         2.887e+01  1.043e+01   2.769 0.005619 ** 
b273        -2.505e+01  7.617e+00  -3.288 0.001009 ** 
b274         2.997e+01  1.043e+01   2.874 0.004058 ** 
b275        -3.067e+01  7.616e+00  -4.026 5.67e-05 ***
b276         3.332e+01  1.043e+01   3.194 0.001405 ** 
b277        -2.989e+01  7.622e+00  -3.922 8.81e-05 ***
b278         2.955e+01  1.043e+01   2.832 0.004627 ** 
b279        -2.715e+01  7.620e+00  -3.563 0.000367 ***
b280         2.784e+01  1.043e+01   2.670 0.007583 ** 
b281        -2.562e+01  7.617e+00  -3.363 0.000772 ***
b282         2.852e+01  1.043e+01   2.736 0.006229 ** 
b283        -2.761e+01  7.616e+00  -3.625 0.000289 ***
b284         3.006e+01  1.043e+01   2.881 0.003965 ** 
b285        -2.780e+01  7.622e+00  -3.648 0.000265 ***
b286         2.734e+01  1.043e+01   2.620 0.008796 ** 
b287        -2.351e+01  7.620e+00  -3.085 0.002039 ** 
b288         2.886e+01  1.043e+01   2.768 0.005641 ** 
b289        -2.629e+01  7.617e+00  -3.451 0.000558 ***
b290         2.751e+01  1.043e+01   2.638 0.008336 ** 
b291        -2.397e+01  7.616e+00  -3.147 0.001649 ** 
b292         2.760e+01  1.043e+01   2.646 0.008151 ** 
b293        -2.497e+01  7.622e+00  -3.276 0.001055 ** 
b294         2.811e+01  1.043e+01   2.694 0.007058 ** 
b295        -2.529e+01  7.620e+00  -3.319 0.000904 ***
b296         3.132e+01  1.043e+01   3.004 0.002663 ** 
b297        -2.701e+01  7.617e+00  -3.545 0.000392 ***
b298         3.048e+01  1.043e+01   2.923 0.003471 ** 
b299        -2.584e+01  7.616e+00  -3.393 0.000693 ***
b300         2.860e+01  1.043e+01   2.742 0.006112 ** 
b301        -2.562e+01  7.622e+00  -3.362 0.000775 ***
b302         2.884e+01  1.043e+01   2.764 0.005711 ** 
b303        -2.428e+01  7.620e+00  -3.186 0.001442 ** 
b304         3.048e+01  1.043e+01   2.924 0.003458 ** 
b305        -2.469e+01  7.617e+00  -3.241 0.001192 ** 
b306         2.625e+01  1.043e+01   2.517 0.011822 *  
b307        -2.559e+01  7.616e+00  -3.360 0.000779 ***
b308         2.926e+01  1.043e+01   2.805 0.005035 ** 
b309        -2.816e+01  7.622e+00  -3.695 0.000220 ***
b310         2.881e+01  1.043e+01   2.761 0.005770 ** 
b311        -2.396e+01  7.620e+00  -3.144 0.001666 ** 
b312         2.953e+01  1.043e+01   2.832 0.004622 ** 
b313        -2.710e+01  7.617e+00  -3.558 0.000374 ***
b314         2.734e+01  1.043e+01   2.622 0.008755 ** 
b315        -2.338e+01  7.616e+00  -3.070 0.002144 ** 
b316         2.550e+01  1.043e+01   2.444 0.014517 *  
b317        -2.194e+01  7.622e+00  -2.879 0.003991 ** 
b318         3.001e+01  1.043e+01   2.876 0.004023 ** 
b319        -2.340e+01  7.620e+00  -3.071 0.002136 ** 
b320         2.959e+01  1.042e+01   2.838 0.004536 ** 
b321        -2.298e+01  7.616e+00  -3.017 0.002551 ** 
b322         2.829e+01  1.042e+01   2.714 0.006646 ** 
b323        -2.527e+01  7.613e+00  -3.319 0.000904 ***
b324         2.903e+01  1.042e+01   2.785 0.005350 ** 
b325        -2.156e+01  7.613e+00  -2.832 0.004626 ** 
b326         2.890e+01  1.041e+01   2.777 0.005490 ** 
b327        -2.444e+01  7.611e+00  -3.212 0.001321 ** 
b328         2.369e+01  1.043e+01   2.271 0.023137 *  
b329        -2.803e+00  1.267e+01  -0.221 0.824870    
b330        -6.063e+04  1.733e+05  -0.350 0.726459    
---
Signif. codes:  0 ‘***’ 0.001 ‘**’ 0.01 ‘*’ 0.05 ‘.’ 0.1 ‘ ’ 1

Residual standard error: 4.143 on 59296 degrees of freedom
  (7401 observations deleted due to missingness)
Multiple R-squared:  0.841,	Adjusted R-squared:  0.8401 
F-statistic: 886.3 on 354 and 59296 DF,  p-value: < 2.2e-16

> 
> # register the results
> data <- data %>% mutate(mu = NA , ctemp = NA)
> for(k in 1:p){
+   data[non_na & row_ids[,k],] <- data[non_na & row_ids[,k],] %>% 
+     mutate(mu = lms[[k]]$fitted.values, ctemp = mean_temp - mu)
+ }
> 
> # remove b cols of data (for memory)
> data <- data %>% 
+   select(!any_of(b_cols[[which.max(sapply(b_cols, length))]])) %>%
+   select(!any_of(c(s_cols, c_cols)))
> gc()
            used   (Mb) gc trigger   (Mb)  max used   (Mb)
Ncells   2494736  133.3    4520295  241.5   4520295  241.5
Vcells 192738243 1470.5  615103926 4692.9 512511027 3910.2
> 
> # quick check
> data0 <- data %>% group_by(year, station_name) %>%
+   summarise(m_mt = mean(mean_temp, na.rm=T),
+             m_mu = mean(mu, na.rm=T))
`summarise()` has grouped output by 'year'. You can override using the
`.groups` argument.
> ggplot(data0, aes(x=year, y=m_mt, col=station_name, group=station_name)) +
+   theme_light() +
+   geom_line(data = data0, aes(y=m_mu), col=1) +
+   geom_point()
Warning messages:
1: Removed 20 row(s) containing missing values (geom_path). 
2: Removed 25 rows containing missing values (geom_point). 
> 
> data0 <- data %>% filter(year %in% 1950:1970) %>%
+   group_by(year, month, station_name) %>%
+   summarise(m_mt = mean(mean_temp, na.rm=T),
+             m_mu = mean(mu, na.rm=T))
`summarise()` has grouped output by 'year', 'month'. You can override using the
`.groups` argument.
> ggplot(data0, aes(x=year+month/12, y=m_mt, col=station_name, group=station_name)) +
+   geom_line() + geom_point() +
+   geom_line(data = data0, aes(y=m_mu)) +
+   facet_wrap(~station_name)
Warning messages:
1: Removed 21 row(s) containing missing values (geom_path). 
2: Removed 21 rows containing missing values (geom_point). 
3: Removed 21 row(s) containing missing values (geom_path). 
> 
> 
> # random check of the fits
> # some plots might show a break (when the data goes from Ottawa to Toronto)
> k <- sample(nrow(data),1)
> ii <- k + 1:365
> plot(data$time[ii], data$mean_temp[ii])
> lines(data$time[ii], data$mu[ii], col=2)
> 
> 
> # note that this breaks the equalities in the data
> # but there is still some heterogeneity in the variance
> N <- 20000 
> par(mfrow=c(p,2), mar=c(1,1,0,0))
> for(k in 1:p){
+   plot(data$yday[row_ids[,k]][1:N], data$mean_temp[row_ids[,k]][1:N], cex=.25)
+   plot(data$yday[row_ids[,k]][1:N], data$ctemp[row_ids[,k]][1:N], cex=.25)
+ }
> 
> 
> 
> # Compute pseudo-observations using ECDF ----------------------------------
> data <- data %>% mutate(pseudo_temp = NA, diff = NA, w1 = NA, w = NA)
> for(k in 1:p){
+   id <- stns_id[k]
+   cat("Working on ECDF for station ", id, ".\n")
+   row_id <- row_ids[,k]
+ 
+   for(tt in 1:366){
+     if(tt %% 20 == 0) cat("progess: ", round(tt/366*100,2), "%\n")
+     
+     # construct weights based on yday using gaussian kernel
+     data[row_id,] <- data[row_id,] %>%
+       mutate(diff = tt - (time %% year_len)) %>%
+       mutate(diff = abs(pmin(diff, year_len - diff))) %>%
+       mutate(w1 = dnorm(diff,0,2)) %>%
+       mutate(w = w1/sum(w1, na.rm = T)) 
+     
+     # construct ecdf function using all the data
+     wecdf <- spatstat.geom::ewcdf(data[row_id,]$ctemp, data[row_id,]$w)
+     
+     # compute ecdf only for yday we care for
+     ind <- which(data[row_id,]$yday == tt & !is.na(data[row_id,]$ctemp))
+     data[row_id,][ind,] <- data[row_id,][ind,] %>%
+       mutate(pseudo_temp = wecdf(ctemp))
+     
+     # heuristic correction for the largest (pseudo_obs = 1)
+     # to avoid modifying all values (say, with pseudo_obs = pseudo_obs*n_ind/(n_ind+1))
+     n_ind <- length(ind)
+     data[row_id,][ind,] <- data[row_id,][ind,] %>%
+       mutate(pseudo_temp = ifelse(pseudo_temp == 1, 1-1/(2*n_ind), pseudo_temp))
+   }
+ }
Working on ECDF for station  568 .
progess:  5.46 %
progess:  10.93 %
progess:  16.39 %
progess:  21.86 %
progess:  27.32 %
progess:  32.79 %
progess:  38.25 %
progess:  43.72 %
progess:  49.18 %
progess:  54.64 %
progess:  60.11 %
progess:  65.57 %
progess:  71.04 %
progess:  76.5 %
progess:  81.97 %
progess:  87.43 %
progess:  92.9 %
progess:  98.36 %
Working on ECDF for station  4333 .
progess:  5.46 %
progess:  10.93 %
progess:  16.39 %
progess:  21.86 %
progess:  27.32 %
progess:  32.79 %
progess:  38.25 %
progess:  43.72 %
progess:  49.18 %
progess:  54.64 %
progess:  60.11 %
progess:  65.57 %
progess:  71.04 %
progess:  76.5 %
progess:  81.97 %
progess:  87.43 %
progess:  92.9 %
progess:  98.36 %
Working on ECDF for station  5051 .
progess:  5.46 %
progess:  10.93 %
progess:  16.39 %
progess:  21.86 %
progess:  27.32 %
progess:  32.79 %
progess:  38.25 %
progess:  43.72 %
progess:  49.18 %
progess:  54.64 %
progess:  60.11 %
progess:  65.57 %
progess:  71.04 %
progess:  76.5 %
progess:  81.97 %
progess:  87.43 %
progess:  92.9 %
progess:  98.36 %
> 
> 
> 
> # resulting histograms are even better than expected
> ggplot(data, aes(x = pseudo_temp, fill=as.factor(yday))) +
+   theme(legend.position = "none") +
+   geom_histogram(breaks=seq(0,1,.05), position = position_stack()) +
+   facet_wrap(~station_name)
Warning message:
Removed 12480 rows containing non-finite values (stat_bin). 
> 
> # quick check of the other operations (tt = 366, last it. of for loop)
> s <- sample(nrow(data) - 1000,1)
> par(mfrow=c(3,1))
> plot(data$pseudo_temp[s + 1:100], type="o") # makes sense
> plot(data$date[s + 1:1000], data$diff[s + 1:1000]) # linear in time, as expected
> plot(data$date[s + 1:1000], data$w[s + 1:1000], type="l") # select only end of year periods
> 
> # note that there are equalities, but very very few of them. can disregard.
> apply(row_ids, 2, \(r){
+   tab <- table(data[r,]$pseudo_temp)
+   tab[tab > 1]
+ })
[[1]]

0.196312515854185 0.652439287004146 0.854300624181735 0.926099029063865 
                3                 2                 2                 2 
0.995867768595041 0.995901639344262 0.995967741935484             0.996 
                3                 2                 2                 3 

[[2]]

0.0936251242555679  0.451173616220594  0.472864001285734  0.736322628189079 
                 2                  2                  2                  2 
 0.972394717184632  0.996212121212121  0.996240601503759  0.996268656716418 
                 2                  2                  5                  2 

[[3]]

0.334750370385655 0.632016838759061 0.996932515337423 0.996951219512195 
                2                 2                 8                 4 

> 
> 
> 
> # Save for later use ------------------------------------------------------
> saveRDS(data, "app/data/data_pp.rds")
> 
> proc.time()
    user   system  elapsed 
1561.496   12.772 1574.444 
